function X2JS(a,b,c){function d(a){var b=a.localName;return null==b&&(b=a.baseName),(null==b||""==b)&&(b=a.nodeName),b}function e(a){return a.prefix}function f(a){return"string"==typeof a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):a}function g(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function h(f){if(f.nodeType==u.DOCUMENT_NODE){var i,j,k,l=f.firstChild;for(j=0,k=f.childNodes.length;k>j;j+=1)if(f.childNodes[j].nodeType!==u.COMMENT_NODE){l=f.childNodes[j];break}if(c)i=h(l);else{i={};var m=d(l);i[m]=h(l)}return i}if(f.nodeType==u.ELEMENT_NODE){var i=new Object;i.__cnt=0;for(var n=f.childNodes,o=0;o<n.length;o++){var l=n.item(o),m=d(l);if(i.__cnt++,null==i[m])i[m]=h(l),i[m+"_asArray"]=new Array(1),i[m+"_asArray"][0]=i[m];else{if(null!=i[m]&&!(i[m]instanceof Array)){var p=i[m];i[m]=new Array,i[m][0]=p,i[m+"_asArray"]=i[m]}for(var q=0;null!=i[m][q];)q++;i[m][q]=h(l)}}for(var r=0;r<f.attributes.length;r++){var s=f.attributes.item(r);i.__cnt++;for(var v=s.value,w=0,x=a.length;x>w;w++){var y=a[w];y.test.call(this,s.value)&&(v=y.converter.call(this,s.value))}i[b+s.name]=v}var z=e(f);return null!=z&&""!=z&&(i.__cnt++,i.__prefix=z),1==i.__cnt&&null!=i["#text"]&&(i=i["#text"]),null!=i["#text"]&&(i.__text=i["#text"],t&&(i.__text=g(i.__text)),delete i["#text"],delete i["#text_asArray"]),null!=i["#cdata-section"]&&(i.__cdata=i["#cdata-section"],delete i["#cdata-section"],delete i["#cdata-section_asArray"]),(null!=i.__text||null!=i.__cdata)&&(i.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),i}return f.nodeType==u.TEXT_NODE||f.nodeType==u.CDATA_SECTION_NODE?f.nodeValue:f.nodeType==u.COMMENT_NODE?null:void 0}function i(a,b,c,d){var e="<"+(null!=a&&null!=a.__prefix?a.__prefix+":":"")+b;if(null!=c)for(var f=0;f<c.length;f++){var g=c[f],h=a[g];e+=" "+g.substr(1)+"='"+h+"'"}return e+=d?"/>":">"}function j(a,b){return"</"+(null!=a.__prefix?a.__prefix+":":"")+b+">"}function k(a,b){return-1!==a.indexOf(b,a.length-b.length)}function l(a,b){return k(b.toString(),"_asArray")||0==b.toString().indexOf("_")||a[b]instanceof Function?!0:!1}function m(a){var b=0;if(a instanceof Object)for(var c in a)l(a,c)||b++;return b}function n(a){var b=[];if(a instanceof Object)for(var c in a)-1==c.toString().indexOf("__")&&0==c.toString().indexOf("_")&&b.push(c);return b}function o(a){var b="";return null!=a.__cdata&&(b+="<![CDATA["+a.__cdata+"]]>"),null!=a.__text&&(b+=t?f(a.__text):a.__text),b}function p(a){var b="";return a instanceof Object?b+=o(a):null!=a&&(b+=t?f(a):a),b}function q(a,b,c){var d="";if(0==a.length)d+=i(a,b,c,!0);else for(var e=0;e<a.length;e++)d+=i(a[e],b,n(a[e]),!1),d+=r(a[e]),d+=j(a[e],b);return d}function r(a){var b="",c=m(a);if(c>0)for(var d in a)if(!l(a,d)){var e=a[d],f=n(e);if(null==e||void 0==e)b+=i(e,d,f,!0);else if(e instanceof Object)if(e instanceof Array)b+=q(e,d,f);else{var g=m(e);g>0||null!=e.__text||null!=e.__cdata?(b+=i(e,d,f,!1),b+=r(e),b+=j(e,d)):b+=i(e,d,f,!0)}else b+=i(e,d,f,!1),b+=p(e),b+=j(e,d)}return b+=p(a)}(null===b||void 0===b)&&(b="_"),(null===c||void 0===c)&&(c=!1);var s="1.0.11",t=!1,u={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(a){var b;if(window.DOMParser){var c=new window.DOMParser;b=c.parseFromString(a,"text/xml")}else 0==a.indexOf("<?")&&(a=a.substr(a.indexOf("?>")+2)),b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a);return b},this.xml2json=function(a){return h(a)},this.xml_str2json=function(a){var b=this.parseXmlString(a);return this.xml2json(b)},this.json2xml_str=function(a){return r(a)},this.json2xml=function(a){var b=this.json2xml_str(a);return this.parseXmlString(b)},this.getVersion=function(){return s},this.escapeMode=function(a){t=a}}function ObjectIron(a){var b;for(b=[],i=0,len=a.length;len>i;i+=1)b.push(a[i].isRoot?"root":a[i].name);var c=function(a,b){var c;if(null!==a&&null!==b)for(c in a)a.hasOwnProperty(c)&&(b.hasOwnProperty(c)||(b[c]=a[c]))},d=function(a,b,d){var e,f,g,h,i;if(null!==a&&0!==a.length)for(e=0,f=a.length;f>e;e+=1)g=a[e],b.hasOwnProperty(g.name)&&(d.hasOwnProperty(g.name)?g.merge&&(h=b[g.name],i=d[g.name],"object"==typeof h&&"object"==typeof i?c(h,i):d[g.name]=null!=g.mergeFunction?g.mergeFunction(h,i):h+i):d[g.name]=b[g.name])},e=function(a,b){var c,f,g,h,i,j,k,l=a;if(null!==l.children&&0!==l.children.length)for(c=0,f=l.children.length;f>c;c+=1)if(j=l.children[c],b.hasOwnProperty(j.name))if(j.isArray)for(i=b[j.name+"_asArray"],g=0,h=i.length;h>g;g+=1)k=i[g],d(l.properties,b,k),e(j,k);else k=b[j.name],d(l.properties,b,k),e(j,k)},f=function(c){var d,g,h,i,j,k,l;if(null===c)return c;if("object"!=typeof c)return c;for(d=0,g=b.length;g>d;d+=1)"root"===b[d]&&(j=a[d],k=c,e(j,k));for(i in c)if(c.hasOwnProperty(i)){if(h=b.indexOf(i),-1!==h)if(j=a[h],j.isArray)for(l=c[i+"_asArray"],d=0,g=l.length;g>d;d+=1)k=l[d],e(j,k);else k=c[i],e(j,k);f(c[i])}return c};return{run:f}}MediaPlayer=function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l="1.1.2",m=a,n=!1,o=!1,p=!0,q=!1,r=MediaPlayer.dependencies.BufferExtensions.BUFFER_SIZE_REQUIRED,s=function(){return!!f&&!!g},t=function(){if(!n)throw"MediaPlayer not initialized!";if(!this.capabilities.supportsMediaSource())return void this.errHandler.capabilityError("mediasource");if(!f||!g)throw"Missing view or source.";o=!0,h=b.getObject("streamController"),h.subscribe(h.eventList.ENAME_STREAMS_COMPOSED,i),c.subscribe(c.eventList.ENAME_MANIFEST_LOADED,h),c.subscribe(c.eventList.ENAME_MANIFEST_LOADED,i),d.subscribe(d.eventList.ENAME_TOP_QUALITY_INDEX_CHANGED,e),h.setVideoModel(k),h.setAutoPlay(p),h.load(g),b.mapValue("scheduleWhilePaused",q),b.mapOutlet("scheduleWhilePaused","stream"),b.mapOutlet("scheduleWhilePaused","scheduleController"),b.mapValue("bufferMax",r),b.injectInto(e,"bufferMax")},u=function(){s()&&t.call(this)},v=function(){o&&h&&(h.unsubscribe(h.eventList.ENAME_STREAMS_COMPOSED,i),c.unsubscribe(c.eventList.ENAME_MANIFEST_UPDATED,h),d.unsubscribe(d.eventList.ENAME_TOP_QUALITY_INDEX_CHANGED,e),h.reset(),h=null,o=!1)};return b=new dijon.System,b.mapValue("system",b),b.mapOutlet("system"),b.injectInto(m),{notifier:void 0,debug:void 0,eventBus:void 0,capabilities:void 0,metricsModel:void 0,errHandler:void 0,setup:function(){j=b.getObject("metricsExt"),c=b.getObject("manifestLoader"),i=b.getObject("manifestUpdater"),e=b.getObject("bufferExt"),d=b.getObject("abrController")},addEventListener:function(a,b,c){this.eventBus.addEventListener(a,b,c)},removeEventListener:function(a,b,c){this.eventBus.removeEventListener(a,b,c)},getVersion:function(){return l},startup:function(){n||(b.injectInto(this),n=!0)},getDebug:function(){return this.debug},getVideoModel:function(){return k},setAutoPlay:function(a){p=a},getAutoPlay:function(){return p},setScheduleWhilePaused:function(a){q=a},getScheduleWhilePaused:function(){return q},setBufferMax:function(a){r=a},getBufferMax:function(){return r},getMetricsExt:function(){return j},getMetricsFor:function(a){var b=this.metricsModel.getReadOnlyMetricsFor(a);return b},getQualityFor:function(a){return d.getQualityFor(a)},setQualityFor:function(a,b){d.setPlaybackQuality(a,b)},getAutoSwitchQuality:function(){return d.getAutoSwitchBitrate()},setAutoSwitchQuality:function(a){d.setAutoSwitchBitrate(a)},attachView:function(a){if(!n)throw"MediaPlayer not initialized!";f=a,k=null,f&&(k=b.getObject("videoModel"),k.setElement(f)),v.call(this),s.call(this)&&u.call(this)},attachSource:function(a){if(!n)throw"MediaPlayer not initialized!";g=a,this.setQualityFor("video",0),this.setQualityFor("audio",0),v.call(this),s.call(this)&&u.call(this)},reset:function(){this.attachSource(null),this.attachView(null)},play:t,isReady:s}},MediaPlayer.prototype={constructor:MediaPlayer},MediaPlayer.dependencies={},MediaPlayer.utils={},MediaPlayer.models={},MediaPlayer.vo={},MediaPlayer.vo.metrics={},MediaPlayer.rules={},MediaPlayer.di={},MediaPlayer.di.Context=function(){"use strict";return{system:void 0,setup:function(){this.system.autoMapOutlets=!0,this.system.mapSingleton("debug",MediaPlayer.utils.Debug),this.system.mapSingleton("eventBus",MediaPlayer.utils.EventBus),this.system.mapSingleton("capabilities",MediaPlayer.utils.Capabilities),this.system.mapSingleton("textTrackExtensions",MediaPlayer.utils.TextTrackExtensions),this.system.mapSingleton("vttParser",MediaPlayer.utils.VTTParser),this.system.mapSingleton("ttmlParser",MediaPlayer.utils.TTMLParser),this.system.mapClass("videoModel",MediaPlayer.models.VideoModel),this.system.mapSingleton("manifestModel",MediaPlayer.models.ManifestModel),this.system.mapSingleton("metricsModel",MediaPlayer.models.MetricsModel),this.system.mapClass("protectionModel",MediaPlayer.models.ProtectionModel),this.system.mapSingleton("textSourceBuffer",MediaPlayer.dependencies.TextSourceBuffer),this.system.mapSingleton("mediaSourceExt",MediaPlayer.dependencies.MediaSourceExtensions),this.system.mapSingleton("sourceBufferExt",MediaPlayer.dependencies.SourceBufferExtensions),this.system.mapSingleton("bufferExt",MediaPlayer.dependencies.BufferExtensions),this.system.mapSingleton("abrController",MediaPlayer.dependencies.AbrController),this.system.mapSingleton("errHandler",MediaPlayer.dependencies.ErrorHandler),this.system.mapSingleton("protectionExt",MediaPlayer.dependencies.ProtectionExtensions),this.system.mapSingleton("videoExt",MediaPlayer.dependencies.VideoModelExtensions),this.system.mapClass("protectionController",MediaPlayer.dependencies.ProtectionController),this.system.mapClass("playbackController",MediaPlayer.dependencies.PlaybackController),this.system.mapClass("liveEdgeFinder",MediaPlayer.dependencies.LiveEdgeFinder),this.system.mapClass("metrics",MediaPlayer.models.MetricsList),this.system.mapClass("downloadRatioRule",MediaPlayer.rules.DownloadRatioRule),this.system.mapClass("insufficientBufferRule",MediaPlayer.rules.InsufficientBufferRule),this.system.mapClass("limitSwitchesRule",MediaPlayer.rules.LimitSwitchesRule),this.system.mapClass("abrRulesCollection",MediaPlayer.rules.BaseRulesCollection),this.system.mapClass("streamProcessor",MediaPlayer.dependencies.StreamProcessor),this.system.mapClass("textController",MediaPlayer.dependencies.TextController),this.system.mapClass("bufferController",MediaPlayer.dependencies.BufferController),this.system.mapSingleton("manifestLoader",MediaPlayer.dependencies.ManifestLoader),this.system.mapSingleton("manifestUpdater",MediaPlayer.dependencies.ManifestUpdater),this.system.mapClass("fragmentController",MediaPlayer.dependencies.FragmentController),this.system.mapClass("fragmentLoader",MediaPlayer.dependencies.FragmentLoader),this.system.mapClass("fragmentModel",MediaPlayer.dependencies.FragmentModel),this.system.mapSingleton("streamController",MediaPlayer.dependencies.StreamController),this.system.mapClass("stream",MediaPlayer.dependencies.Stream),this.system.mapClass("requestScheduler",MediaPlayer.dependencies.RequestScheduler),this.system.mapSingleton("schedulerExt",MediaPlayer.dependencies.SchedulerExtensions),this.system.mapClass("schedulerModel",MediaPlayer.dependencies.SchedulerModel),this.system.mapClass("scheduleController",MediaPlayer.dependencies.ScheduleController),this.system.mapSingleton("notifier",MediaPlayer.dependencies.Notifier)}}},Dash=function(){"use strict";return{modules:{},dependencies:{},vo:{},di:{}}}(),Dash.di.DashContext=function(){"use strict";return{system:void 0,setup:function(){Dash.di.DashContext.prototype.setup.call(this),this.system.mapClass("parser",Dash.dependencies.DashParser),this.system.mapClass("indexHandler",Dash.dependencies.DashHandler),this.system.mapSingleton("baseURLExt",Dash.dependencies.BaseURLExtensions),this.system.mapClass("fragmentExt",Dash.dependencies.FragmentExtensions),this.system.mapClass("representationController",Dash.dependencies.RepresentationController),this.system.mapSingleton("manifestExt",Dash.dependencies.DashManifestExtensions),this.system.mapSingleton("metricsExt",Dash.dependencies.DashMetricsExtensions),this.system.mapSingleton("timelineConverter",Dash.dependencies.TimelineConverter)}}},Dash.di.DashContext.prototype=new MediaPlayer.di.Context,Dash.di.DashContext.prototype.constructor=Dash.di.DashContext,function(a){"use strict";var b={VERSION:"0.5.3"};b.System=function(){this._mappings={},this._outlets={},this._handlers={},this.strictInjections=!0,this.autoMapOutlets=!1,this.postInjectionHook="setup"},b.System.prototype={_createAndSetupInstance:function(a,b){var c=new b;return this.injectInto(c,a),c},_retrieveFromCacheOrCreate:function(a,b){"undefined"==typeof b&&(b=!1);var c;if(!this._mappings.hasOwnProperty(a))throw new Error(1e3);var d=this._mappings[a];return!b&&d.isSingleton?(null==d.object&&(d.object=this._createAndSetupInstance(a,d.clazz)),c=d.object):c=d.clazz?this._createAndSetupInstance(a,d.clazz):d.object,c},mapOutlet:function(a,b,c){if("undefined"==typeof a)throw new Error(1010);return b=b||"global",c=c||a,this._outlets.hasOwnProperty(b)||(this._outlets[b]={}),this._outlets[b][c]=a,this},getObject:function(a){if("undefined"==typeof a)throw new Error(1020);return this._retrieveFromCacheOrCreate(a)},mapValue:function(a,b){if("undefined"==typeof a)throw new Error(1030);return this._mappings[a]={clazz:null,object:b,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(a),this.hasMapping(a)&&this.injectInto(b,a),this},hasMapping:function(a){if("undefined"==typeof a)throw new Error(1040);return this._mappings.hasOwnProperty(a)},mapClass:function(a,b){if("undefined"==typeof a)throw new Error(1050);if("undefined"==typeof b)throw new Error(1051);return this._mappings[a]={clazz:b,object:null,isSingleton:!1},this.autoMapOutlets&&this.mapOutlet(a),this},mapSingleton:function(a,b){if("undefined"==typeof a)throw new Error(1060);if("undefined"==typeof b)throw new Error(1061);return this._mappings[a]={clazz:b,object:null,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(a),this},instantiate:function(a){if("undefined"==typeof a)throw new Error(1070);return this._retrieveFromCacheOrCreate(a,!0)},injectInto:function(a,b){if("undefined"==typeof a)throw new Error(1080);if("object"==typeof a){var c=[];this._outlets.hasOwnProperty("global")&&c.push(this._outlets.global),"undefined"!=typeof b&&this._outlets.hasOwnProperty(b)&&c.push(this._outlets[b]);for(var d in c){var e=c[d];for(var f in e){var g=e[f];(!this.strictInjections||f in a)&&(a[f]=this.getObject(g))}}"setup"in a&&a.setup.call(a)}return this},unmap:function(a){if("undefined"==typeof a)throw new Error(1090);return delete this._mappings[a],this},unmapOutlet:function(a,b){if("undefined"==typeof a)throw new Error(1100);if("undefined"==typeof b)throw new Error(1101);return delete this._outlets[a][b],this},mapHandler:function(a,b,c,d,e){if("undefined"==typeof a)throw new Error(1110);return b=b||"global",c=c||a,"undefined"==typeof d&&(d=!1),"undefined"==typeof e&&(e=!1),this._handlers.hasOwnProperty(a)||(this._handlers[a]={}),this._handlers[a].hasOwnProperty(b)||(this._handlers[a][b]=[]),this._handlers[a][b].push({handler:c,oneShot:d,passEvent:e}),this},unmapHandler:function(a,b,c){if("undefined"==typeof a)throw new Error(1120);if(b=b||"global",c=c||a,this._handlers.hasOwnProperty(a)&&this._handlers[a].hasOwnProperty(b)){var d=this._handlers[a][b];for(var e in d){var f=d[e];if(f.handler===c){d.splice(e,1);break}}}return this},notify:function(a){if("undefined"==typeof a)throw new Error(1130);var b=Array.prototype.slice.call(arguments),c=b.slice(1);if(this._handlers.hasOwnProperty(a)){var d=this._handlers[a];for(var e in d){var f,g=d[e];"global"!==e&&(f=this.getObject(e));var h,i,j=[];for(h=0,i=g.length;i>h;h++){var k,l=g[h];k=f&&"string"==typeof l.handler?f[l.handler]:l.handler,l.oneShot&&j.unshift(h),l.passEvent?k.apply(f,b):k.apply(f,c)}for(h=0,i=j.length;i>h;h++)g.splice(j[h],1)}}return this}},a.dijon=b}(this),Dash.dependencies.BaseURLExtensions=function(){"use strict";var a=function(a,b){for(var c,d,e,f,g,h,i,j,k,l,m=new DataView(a),n={},o=0;"sidx"!==j&&o<m.byteLength;){for(k=m.getUint32(o),o+=4,j="",f=0;4>f;f+=1)l=m.getInt8(o),j+=String.fromCharCode(l),o+=1;"moof"!==j&&"traf"!==j&&"sidx"!==j?o+=k-8:"sidx"===j&&(o-=8)}if(e=m.getUint32(o,!1)+o,e>a.byteLength)throw"sidx terminates after array buffer";for(n.version=m.getUint8(o+8),o+=12,n.timescale=m.getUint32(o+4,!1),o+=8,0===n.version?(n.earliest_presentation_time=m.getUint32(o,!1),n.first_offset=m.getUint32(o+4,!1),o+=8):(n.earliest_presentation_time=utils.Math.to64BitNumber(m.getUint32(o+4,!1),m.getUint32(o,!1)),n.first_offset=(m.getUint32(o+8,!1)<<32)+m.getUint32(o+12,!1),o+=16),n.first_offset+=e+(b||0),n.reference_count=m.getUint16(o+2,!1),o+=4,n.references=[],c=n.first_offset,d=n.earliest_presentation_time,f=0;f<n.reference_count;f+=1)h=m.getUint32(o,!1),g=h>>>31,h=2147483647&h,i=m.getUint32(o+4,!1),o+=12,n.references.push({size:h,type:g,offset:c,duration:i,time:d,timescale:n.timescale}),c+=h,d+=i;if(o!==e)throw"Error: final pos "+o+" differs from SIDX end "+e;return n},b=function(b,c,d){var e,f,g,h,i,j,k,l;for(e=a.call(this,b,d),f=e.references,g=[],i=0,j=f.length;j>i;i+=1)h=new Dash.vo.Segment,h.duration=f[i].duration,h.media=c,h.startTime=f[i].time,h.timescale=f[i].timescale,k=f[i].offset,l=f[i].offset+f[i].size-1,h.mediaRange=k+"-"+l,g.push(h);return this.debug.log("Parsed SIDX box: "+g.length+" segments."),g},c=function(a,b,d){var e,f,g,h,i,j,k,l=new DataView(a),m=0,n="",o=0,p=!1,q=this;for(q.debug.log("Searching for initialization.");"moov"!==n&&m<l.byteLength;){for(o=l.getUint32(m),m+=4,n="",h=0;4>h;h+=1)i=l.getInt8(m),n+=String.fromCharCode(i),m+=1;"moov"!==n&&(m+=o-8)}g=l.byteLength-m,"moov"!==n?(q.debug.log("Loading more bytes to find initialization."),b.range.start=0,b.range.end=b.bytesLoaded+b.bytesToLoad,j=new XMLHttpRequest,j.onloadend=function(){p||d.call(q,null,new Error("Error loading initialization."))},j.onload=function(){p=!0,b.bytesLoaded=b.range.end,c.call(q,j.response,function(a){d.call(q,a)})},j.onerror=function(){d.call(q,null,new Error("Error loading initialization."))},j.open("GET",b.url),j.responseType="arraybuffer",j.setRequestHeader("Range","bytes="+b.range.start+"-"+b.range.end),j.send(null)):(e=m-8,f=e+o-1,k=e+"-"+f,q.debug.log("Found the initialization.  Range: "+k),d.call(q,k))},d=function(a){var b=new XMLHttpRequest,d=!0,e=this,f=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].BaseURL,g={url:f,range:{},searching:!1,bytesLoaded:0,bytesToLoad:1500,request:b};e.debug.log("Start searching for initialization."),g.range.start=0,g.range.end=g.bytesToLoad,b.onload=function(){b.status<200||b.status>299||(d=!1,g.bytesLoaded=g.range.end,c.call(e,b.response,g,function(b){a.range=b,a.initialization=f,e.notify(e.eventList.ENAME_INITIALIZATION_LOADED,a)}))},b.onloadend=b.onerror=function(){d&&(d=!1,e.errHandler.downloadError("initialization",g.url,b),e.notify(e.eventList.ENAME_INITIALIZATION_LOADED,a))},b.open("GET",g.url),b.responseType="arraybuffer",b.setRequestHeader("Range","bytes="+g.range.start+"-"+g.range.end),b.send(null),e.debug.log("Perform init search: "+g.url)},e=function(a,c,d,g){var h,i,j,k,l,m,n,o,p,q=new DataView(a),r=new XMLHttpRequest,s=0,t="",u=0,v=!0,w=!1,x=this;for(x.debug.log("Searching for SIDX box."),x.debug.log(c.bytesLoaded+" bytes loaded.");"sidx"!==t&&s<q.byteLength;){for(u=q.getUint32(s),s+=4,t="",m=0;4>m;m+=1)n=q.getInt8(s),t+=String.fromCharCode(n),s+=1;"sidx"!==t&&(s+=u-8)}if(i=q.byteLength-s,"sidx"!==t)g.call(x);else if(u-8>i)x.debug.log("Found SIDX but we don't have all of it."),c.range.start=0,c.range.end=c.bytesLoaded+(u-i),r.onload=function(){r.status<200||r.status>299||(v=!1,c.bytesLoaded=c.range.end,e.call(x,r.response,c,d,g))},r.onloadend=r.onerror=function(){v&&(v=!1,x.errHandler.downloadError("SIDX",c.url,r),g.call(x))},r.open("GET",c.url),r.responseType="arraybuffer",r.setRequestHeader("Range","bytes="+c.range.start+"-"+c.range.end),r.send(null);else if(c.range.start=s-8,c.range.end=c.range.start+u,x.debug.log("Found the SIDX box.  Start: "+c.range.start+" | End: "+c.range.end),j=new ArrayBuffer(c.range.end-c.range.start),l=new Uint8Array(j),k=new Uint8Array(a,c.range.start,c.range.end-c.range.start),l.set(k),o=this.parseSIDX.call(this,j,c.range.start),p=o.references,null!==p&&void 0!==p&&p.length>0&&(w=1===p[0].type),w){x.debug.log("Initiate multiple SIDX load.");var y,z,A,B,C,D=[],E=0,F=function(a){a?(D=D.concat(a),E+=1,E>=z&&g.call(x,D)):g.call(x)};for(y=0,z=p.length;z>y;y+=1)A=p[y].offset,B=p[y].offset+p[y].size-1,C=A+"-"+B,f.call(x,d,null,C,F)}else x.debug.log("Parsing segments from SIDX."),h=b.call(x,j,c.url,c.range.start),g.call(x,h)},f=function(a,c,d,f){var g,h,i=new XMLHttpRequest,j=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].BaseURL,k=!0,l=this,m={url:j,range:{},searching:!1,bytesLoaded:0,bytesToLoad:1500,request:i};null===d?(l.debug.log("No known range for SIDX request."),m.searching=!0,m.range.start=0,m.range.end=m.bytesToLoad):(h=d.split("-"),m.range.start=parseFloat(h[0]),m.range.end=parseFloat(h[1])),i.onload=function(){i.status<200||i.status>299||(k=!1,m.searching?(m.bytesLoaded=m.range.end,e.call(l,i.response,m,a,function(b){b&&f.call(l,b,a,c)})):(g=b.call(l,i.response,m.url,m.range.start),f.call(l,g,a,c)))},i.onloadend=i.onerror=function(){k&&(k=!1,l.errHandler.downloadError("SIDX",m.url,i),f.call(l,null,a,c))},i.open("GET",m.url),i.responseType="arraybuffer",i.setRequestHeader("Range","bytes="+m.range.start+"-"+m.range.end),i.send(null),l.debug.log("Perform SIDX load: "+m.url)},g=function(a,b,c){var d=this;a?d.notify(d.eventList.ENAME_SEGMENTS_LOADED,a,b,c):d.notify(d.eventList.ENAME_SEGMENTS_LOADED,null,b,c,new Error("error loading segments"))};return{debug:void 0,errHandler:void 0,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,loadSegments:function(a,b,c){f.call(this,a,b,c,g.bind(this))},loadInitialization:d,parseSegments:b,parseSIDX:a,findSIDX:e}},Dash.dependencies.BaseURLExtensions.prototype={constructor:Dash.dependencies.BaseURLExtensions},Dash.dependencies.DashHandler=function(){"use strict";var a,b,c,d=-1,e=function(a,b){var c=b.toString();return a.split("$Number$").join(c)},f=function(a,b){var c=b.toString();return a.split("$Time$").join(c)},g=function(a,b){var c=b.toString();return a.split("$Bandwidth$").join(c)},h=function(a,b){if(null===b||-1===a.indexOf("$RepresentationID$"))return a;var c=b.toString();return a.split("$RepresentationID$").join(c)},i=function(a,b){return a.representation.startNumber+b},j=function(a,b){var c,d=b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].BaseURL;return c=a===d?a:-1!==a.indexOf("http://")?a:d+a},k=function(a,c){var d,e,f=this,g=new MediaPlayer.vo.SegmentRequest;return d=a.adaptation.period,g.streamType=c,g.type="Initialization Segment",g.url=j(a.initialization,a),g.range=a.range,e=d.start,g.availabilityStartTime=f.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(e,a.adaptation.period.mpd,b),g.availabilityEndTime=f.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(e+d.duration,d.mpd,b),g.quality=a.index,g},l=function(a){var b,d=this;return a?b=k.call(d,a,c):null},m=function(a){var c,e,f,g=a.adaptation.period,h=!1;return b?h=!1:0>d?h=!1:d<a.availableSegmentsNumber?(e=z(d,a),e&&(f=e.presentationStartTime-g.start,c=a.adaptation.period.duration,this.debug.log(a.segmentInfoType+": "+f+" / "+c),h=f>=c)):h=!0,h},n=function(a,c){var d,e,f,g,h=this;return e=a.segmentDuration,f=a.adaptation.period.start+c*e,g=f+e,d=new Dash.vo.Segment,d.representation=a,d.duration=e,d.presentationStartTime=f,d.mediaStartTime=h.timelineConverter.calcMediaTimeFromPresentationTime(d.presentationStartTime,a),d.availabilityStartTime=h.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(d.presentationStartTime,a.adaptation.period.mpd,b),d.availabilityEndTime=h.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(g,a.adaptation.period.mpd,b),d.wallStartTime=h.timelineConverter.calcWallTimeForSegment(d,b),d.replacementNumber=i(d,c),d.availabilityIdx=c,d},o=function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=this,t=b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].SegmentTemplate,u=t.SegmentTimeline,v=b.availableSegmentsNumber>0,w=10,x=[],y=0,z=-1,A=function(a){return s.call(q,b,y,a.d,p,t.media,a.mediaRange,z)};for(p=b.timescale,c=u.S_asArray,k=r.call(q,b),k?(n=k.start,o=k.end):m=q.timelineConverter.calcMediaTimeFromPresentationTime(a||0,b),e=0,f=c.length;f>e;e+=1)if(d=c[e],h=0,d.hasOwnProperty("r")&&(h=d.r),d.hasOwnProperty("t")&&(y=d.t),0>h&&(j=c[e+1],i=j&&j.hasOwnProperty("t")?j.t/p:b.adaptation.period.duration,h=Math.ceil((i-y/p)/(d.d/p))-1),l){if(v)break;z+=h+1}else for(g=0;h>=g;g+=1){if(z+=1,k){if(z>o){if(l=!0,v)break;continue}z>=n&&x.push(A.call(q,d))}else{if(x.length>w){l=!0;break}m>=y/p&&x.push(A.call(q,d))}y+=d.d}if(!v){var B,C,D=c[0];B=q.timelineConverter.calcPresentationTimeFromMediaTime(D.t/p,b),C=q.timelineConverter.calcPresentationTimeFromMediaTime((y-d.d)/p,b),b.segmentAvailabilityRange={start:B,end:C},b.availableSegmentsNumber=z+1}return x},p=function(a){var b,c,d,g,h,i=[],j=this,k=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].SegmentTemplate,l=a.segmentDuration,m=a.segmentAvailabilityRange,o=null,p=null;for(h=a.startNumber,b=q.call(j,a),d=b.start,g=b.end,c=d;g>=c;c+=1)o=n.call(j,a,c),o.replacementTime=(h+c-1)*a.segmentDuration,p=k.media,p=e(p,o.replacementNumber),p=f(p,o.replacementTime),o.media=p,i.push(o),o=null;return a.availableSegmentsNumber=Math.ceil((m.end-m.start)/l),i},q=function(c){var e,f,g,h=c.segmentDuration,i=c.adaptation.period.mpd.manifest.minBufferTime,j=c.segmentAvailabilityRange,k=0/0,l=null,m=c.segments,n=2*h,o=Math.max(2*i,10*h);return b&&!c.adaptation.period.isClientServerTimeSyncCompleted?(e=Math.floor(j.start/h),f=Math.floor(j.end/h),g={start:e,end:f}):(m?(l=z(d,c),k=l?l.presentationStartTime:d>0?d*h:a||m[0].presentationStartTime):k=d>0?d*h:b?j.end:j.start,e=Math.floor(Math.max(k-n,j.start)/h),f=Math.floor(Math.min(k+o,j.end)/h),g={start:e,end:f})},r=function(a){var c,e,f,g=0/0,h=a.segments,i=2,j=10,k=0,l=Number.POSITIVE_INFINITY;if(b&&!a.adaptation.period.isClientServerTimeSyncCompleted)return f={start:k,end:l};if(h){if(0>d)return null;g=d}else g=d>0?d:b?l:k;return c=Math.max(g-i,k),e=Math.min(g+j,l),f={start:c,end:e}},s=function(a,c,d,g,h,j,k){var l,m,n,o=this,p=c/g,q=Math.min(d/g,a.adaptation.period.mpd.maxSegmentDuration);return l=o.timelineConverter.calcPresentationTimeFromMediaTime(p,a),m=l+q,n=new Dash.vo.Segment,n.representation=a,n.duration=q,n.mediaStartTime=p,n.presentationStartTime=l,n.availabilityStartTime=a.adaptation.period.mpd.manifest.mpdLoadedTime,n.availabilityEndTime=o.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(m,a.adaptation.period.mpd,b),n.wallStartTime=o.timelineConverter.calcWallTimeForSegment(n,b),n.replacementTime=c,n.replacementNumber=i(n,k),h=e(h,n.replacementNumber),h=f(h,n.replacementTime),n.media=h,n.mediaRange=j,n.availabilityIdx=k,n},t=function(a){var b,c,d,e,f,g,h,i=this,j=[],k=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].SegmentList,l=k.SegmentURL_asArray.length;for(h=a.startNumber,e=q.call(i,a),f=e.start,g=e.end,b=f;g>b;b+=1)d=k.SegmentURL_asArray[b],c=n.call(i,a,b),c.replacementTime=(h+b-1)*a.segmentDuration,c.media=d.media,c.mediaRange=d.mediaRange,c.index=d.index,c.indexRange=d.indexRange,j.push(c),c=null;return a.availableSegmentsNumber=l,j},u=function(a){var b,c=this,d=a.segmentInfoType;return"SegmentBase"!==d&&"BaseURL"!==d&&A.call(c,a)?("SegmentTimeline"===d?b=o.call(c,a):"SegmentTemplate"===d?b=p.call(c,a):"SegmentList"===d&&(b=t.call(c,a)),v.call(c,a,b)):b=a.segments,b},v=function(a,c){var d;a.segments=c,d=c.length-1,b&&isNaN(a.adaptation.period.liveEdge)&&(a.adaptation.period.liveEdge=c[d].presentationStartTime)},w=function(a){var b=this;if(!a)throw new Error("no representation");return"video"!==c&&"audio"!==c?null:(a.segments=null,u.call(b,a),a)},x=function(a){var d=this,e=a.initialization,f="BaseURL"!==a.segmentInfoType&&"SegmentBase"!==a.segmentInfoType;a.segmentAvailabilityRange=d.timelineConverter.calcSegmentAvailabilityRange(a,b),w.call(d,a),e||d.baseURLExt.loadInitialization(a),f||d.baseURLExt.loadSegments(a,c,a.indexRange),e&&f&&d.notify(d.eventList.ENAME_REPRESENTATION_UPDATED,a)},y=function(a,b){var c,d,e,f,g=b.segments,h=g.length-1,i=-1;if(g&&g.length>0)for(f=h;f>=0;f--){if(c=g[f],d=c.presentationStartTime,e=c.duration,a+Dash.dependencies.DashHandler.EPSILON>=d&&a-Dash.dependencies.DashHandler.EPSILON<=d+e){i=c.availabilityIdx;break}-1===i&&a-Dash.dependencies.DashHandler.EPSILON>d+e&&(i=isNaN(b.segmentDuration)?c.availabilityIdx+1:Math.floor(a/b.segmentDuration))}return-1===i&&(isNaN(b.segmentDuration)?(console.log("Couldn't figure out a time!"),console.log("Time: "+a),console.log(g)):i=Math.floor(a/b.segmentDuration)),i},z=function(a,b){if(!b||!b.segments)return null;var c,d,e=b.segments.length;for(d=0;e>d;d+=1)if(c=b.segments[d],c.availabilityIdx===a)return c;return null},A=function(a){var b,c,e=!1,f=a.segments;return f?(c=f[0].availabilityIdx,b=f[f.length-1].availabilityIdx,e=c>d||d>b):e=!0,e},B=function(a){if(null===a||void 0===a)return null;var b,d=new MediaPlayer.vo.SegmentRequest,i=a.representation,k=i.adaptation.period.mpd.manifest.Period_asArray[i.adaptation.period.index].AdaptationSet_asArray[i.adaptation.index].Representation_asArray[i.index].bandwidth;return b=j(a.media,i),b=e(b,a.replacementNumber),b=f(b,a.replacementTime),b=g(b,k),b=h(b,i.id),d.streamType=c,d.type="Media Segment",d.url=b,d.range=a.mediaRange,d.startTime=a.presentationStartTime,d.duration=a.duration,d.timescale=i.timescale,d.availabilityStartTime=a.availabilityStartTime,d.availabilityEndTime=a.availabilityEndTime,d.wallStartTime=a.wallStartTime,d.quality=i.index,d.index=a.availabilityIdx,d},C=function(b,c){var e,f,g,h=this;return b?(a=c,h.debug.log("Getting the request for time: "+c),u.call(h,b),d=y.call(h,c,b),h.debug.log("Index for time "+c+" is "+d),g=m.call(h,b),g?(e=new MediaPlayer.vo.SegmentRequest,e.action=e.ACTION_COMPLETE,e.index=d,h.debug.log("Signal complete."),h.debug.log(e)):(f=z(d,b),e=B.call(h,f)),e):null},D=function(a){var b,c,e,f,g=this;if(!a)return null;if(-1===d)throw"You must call getSegmentRequestForTime first.";return d+=1,f=d,e=m.call(g,a),e?(b=new MediaPlayer.vo.SegmentRequest,b.action=b.ACTION_COMPLETE,b.index=f,g.debug.log("Signal complete.")):(u.call(g,a),c=z(f,a),b=B.call(g,c)),b},E=function(a,b,c){var d,e,f,g=this,h=Math.max(b-c,0);if(!a)throw new Error("no represenation");return e=u.call(g,a),d=e[0].duration,f=Math.ceil(h/d)},F=function(a){var b,c,e,f=this;if(!a)throw new Error("no represenation");return c=d,e=u.call(f,a),0>c?b=f.timelineConverter.calcPresentationStartTime(a.adaptation.period):(c=c<e[0].availabilityIdx?e[0].availabilityIdx:Math.min(e[e.length-1].availabilityIdx,c),b=z(c,a).presentationStartTime),b},G=function(a,b){b.segments&&this.notify(this.eventList.ENAME_REPRESENTATION_UPDATED,b)},H=function(a,b,d,e,f){if(!f&&c===e){var g,h,i,j,k=this,l=[],m=0;for(g=0,h=b.length;h>g;g+=1)i=b[g],j=s.call(k,d,i.startTime,i.duration,i.timescale,i.media,i.mediaRange,m),l.push(j),j=null,m+=1;d.segmentAvailabilityRange={start:l[0].presentationStartTime,end:l[h-1].presentationStartTime},d.availableSegmentsNumber=h,v.call(k,d,l),d.initialization&&this.notify(this.eventList.ENAME_REPRESENTATION_UPDATED,d)
}};return{debug:void 0,baseURLExt:void 0,timelineConverter:void 0,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this.initializationLoaded=G,this.segmentsLoaded=H},getType:function(){return c},setType:function(a){c=a},getIsDynamic:function(){return b},setIsDynamic:function(a){b=a},getInitRequest:l,getSegmentRequestForTime:C,getNextSegmentRequest:D,getCurrentTime:F,getSegmentCountForDuration:E,updateRepresentation:x}},Dash.dependencies.DashHandler.EPSILON=.003,Dash.dependencies.DashHandler.prototype={constructor:Dash.dependencies.DashHandler},Dash.dependencies.DashManifestExtensions=function(){"use strict";this.timelineConverter=void 0},Dash.dependencies.DashManifestExtensions.prototype={constructor:Dash.dependencies.DashManifestExtensions,getIsTypeOf:function(a,b){"use strict";var c,d,e,f=a.ContentComponent_asArray,g=new RegExp("text"!==b?b:"(vtt|ttml)"),h=!1,i=!1;if(f)for(c=0,d=f.length;d>c;c+=1)f[c].contentType===b&&(h=!0,i=!0);if(a.hasOwnProperty("mimeType")&&(h=g.test(a.mimeType),i=!0),!i)for(c=0,d=a.Representation_asArray.length;!i&&d>c;)e=a.Representation_asArray[c],e.hasOwnProperty("mimeType")&&(h=g.test(e.mimeType),i=!0),c+=1;return h},getIsAudio:function(a){"use strict";return this.getIsTypeOf(a,"audio")},getIsVideo:function(a){"use strict";return this.getIsTypeOf(a,"video")},getIsText:function(a){"use strict";return this.getIsTypeOf(a,"text")},getIsTextTrack:function(a){return"text/vtt"===a||"application/ttml+xml"===a},getIsMain:function(){"use strict";return!1},processAdaptation:function(a){"use strict";return void 0!==a.Representation_asArray&&null!==a.Representation_asArray&&a.Representation_asArray.sort(function(a,b){return a.bandwidth-b.bandwidth}),a},getDataForId:function(a,b,c){"use strict";var d,e,f=b.Period_asArray[c].AdaptationSet_asArray;for(d=0,e=f.length;e>d;d+=1)if(f[d].hasOwnProperty("id")&&f[d].id===a)return f[d];return null},getDataForIndex:function(a,b,c){"use strict";var d=b.Period_asArray[c].AdaptationSet_asArray;return d[a]},getDataIndex:function(a,b,c){"use strict";var d,e,f=b.Period_asArray[c].AdaptationSet_asArray;for(d=0,e=f.length;e>d;d+=1)if(f[d]===a)return d;return-1},getDatasForType:function(a,b,c){"use strict";var d,e,f=this,g=a.Period_asArray[b].AdaptationSet_asArray,h=[];for(d=0,e=g.length;e>d;d+=1)this.getIsTypeOf(g[d],c)&&h.push(f.processAdaptation(g[d]));return h},getDataForType:function(a,b,c){"use strict";var d,e,f,g=this;if(f=this.getDatasForType(a,b,c),!f||0===f.length)return null;for(d=0,e=f.length;e>d;d+=1)if(g.getIsMain(f[d]))return f[d];return f[0]},getCodec:function(a){"use strict";var b=a.Representation_asArray[0],c=b.mimeType+';codecs="'+b.codecs+'"';return c},getMimeType:function(a){"use strict";return a.Representation_asArray[0].mimeType},getKID:function(a){"use strict";return a&&a.hasOwnProperty("cenc:default_KID")?a["cenc:default_KID"]:null},getContentProtectionData:function(a){"use strict";return a&&a.hasOwnProperty("ContentProtection_asArray")&&0!==a.ContentProtection_asArray.length?a.ContentProtection_asArray:null},getIsDynamic:function(a){"use strict";var b=!1,c="dynamic";return a.hasOwnProperty("type")&&(b=a.type===c),b},getIsDVR:function(a){"use strict";var b,c,d=this.getIsDynamic(a);return b=!isNaN(a.timeShiftBufferDepth),c=d&&b},getIsOnDemand:function(a){"use strict";var b=!1;return a.profiles&&a.profiles.length>0&&(b=-1!==a.profiles.indexOf("urn:mpeg:dash:profile:isoff-on-demand:2011")),b},getDuration:function(a){var b;return b=a.hasOwnProperty("mediaPresentationDuration")?a.mediaPresentationDuration:Number.POSITIVE_INFINITY},getBandwidth:function(a){"use strict";return a.bandwidth},getRefreshDelay:function(a){"use strict";var b=0/0;return a.hasOwnProperty("minimumUpdatePeriod")&&(b=parseFloat(a.minimumUpdatePeriod)),b},getRepresentationCount:function(a){"use strict";return a.Representation_asArray.length},getRepresentationFor:function(a,b){"use strict";return b.Representation_asArray[a]},getRepresentationsForAdaptation:function(a,b){for(var c,d,e,f,g=a.Period_asArray[b.period.index].AdaptationSet_asArray[b.index],h=this,i=[],j=0;j<g.Representation_asArray.length;j+=1)f=g.Representation_asArray[j],c=new Dash.vo.Representation,c.index=j,c.adaptation=b,f.hasOwnProperty("id")&&(c.id=f.id),f.hasOwnProperty("SegmentBase")?(e=f.SegmentBase,c.segmentInfoType="SegmentBase"):f.hasOwnProperty("SegmentList")?(e=f.SegmentList,c.segmentInfoType="SegmentList"):f.hasOwnProperty("SegmentTemplate")?(e=f.SegmentTemplate,c.segmentInfoType=e.hasOwnProperty("SegmentTimeline")?"SegmentTimeline":"SegmentTemplate",e.hasOwnProperty("initialization")&&(c.initialization=e.initialization.split("$Bandwidth$").join(f.bandwidth).split("$RepresentationID$").join(f.id))):(e=f.BaseURL,c.segmentInfoType="BaseURL"),e.hasOwnProperty("Initialization")?(d=e.Initialization,d.hasOwnProperty("sourceURL")?c.initialization=d.sourceURL:d.hasOwnProperty("range")&&(c.initialization=f.BaseURL,c.range=d.range)):f.hasOwnProperty("mimeType")&&h.getIsTextTrack(f.mimeType)&&(c.initialization=f.BaseURL,c.range=0),e.hasOwnProperty("timescale")&&(c.timescale=e.timescale),e.hasOwnProperty("duration")&&(c.segmentDuration=e.duration/c.timescale),e.hasOwnProperty("startNumber")&&(c.startNumber=e.startNumber),e.hasOwnProperty("indexRange")&&(c.indexRange=e.indexRange),e.hasOwnProperty("presentationTimeOffset")&&(c.presentationTimeOffset=e.presentationTimeOffset/c.timescale),c.MSETimeOffset=h.timelineConverter.calcMSETimeOffset(c),i.push(c);return i},getAdaptationsForPeriod:function(a,b){for(var c,d=a.Period_asArray[b.index],e=[],f=0;f<d.AdaptationSet_asArray.length;f+=1)c=new Dash.vo.AdaptationSet,c.index=f,c.period=b,e.push(c);return e},getRegularPeriods:function(a,b){var c,d,e=this,f=[],g=e.getIsDynamic(a),h=null,i=null,j=null,k=null;for(c=0,d=a.Period_asArray.length;d>c;c+=1)i=a.Period_asArray[c],i.hasOwnProperty("start")?(k=new Dash.vo.Period,k.start=i.start):null!==h&&i.hasOwnProperty("duration")?(k=new Dash.vo.Period,k.start=j.start+j.duration,k.duration=i.duration):0!==c||g||(k=new Dash.vo.Period,k.start=0),null!==j&&isNaN(j.duration)&&(j.duration=k.start-j.start),null!==k&&i.hasOwnProperty("id")&&(k.id=i.id),null!==k&&i.hasOwnProperty("duration")&&(k.duration=i.duration),null!==k&&(k.index=c,k.mpd=b,f.push(k)),h=i,i=null,j=k,k=null;return 0===f.length?f:(b.checkTime=e.getCheckTime(a,f[0]),null!==j&&isNaN(j.duration)&&(j.duration=e.getEndTimeForLastPeriod(b)-j.start),f)},getMpd:function(a){var b=new Dash.vo.Mpd;return b.manifest=a,b.availabilityStartTime=new Date(a.hasOwnProperty("availabilityStartTime")?a.availabilityStartTime.getTime():a.mpdLoadedTime.getTime()),a.hasOwnProperty("availabilityEndTime")&&(b.availabilityEndTime=new Date(a.availabilityEndTime.getTime())),a.hasOwnProperty("suggestedPresentationDelay")&&(b.suggestedPresentationDelay=a.suggestedPresentationDelay),a.hasOwnProperty("timeShiftBufferDepth")&&(b.timeShiftBufferDepth=a.timeShiftBufferDepth),a.hasOwnProperty("maxSegmentDuration")&&(b.maxSegmentDuration=a.maxSegmentDuration),b},getFetchTime:function(a,b){var c=this.timelineConverter.calcPresentationTimeFromWallTime(a.mpdLoadedTime,b,!0);return c},getCheckTime:function(a,b){var c,d=this,e=0/0;return a.hasOwnProperty("minimumUpdatePeriod")&&(c=d.getFetchTime(a,b),e=c+a.minimumUpdatePeriod),e},getEndTimeForLastPeriod:function(a){var b;if(a.manifest.mediaPresentationDuration)b=a.manifest.mediaPresentationDuration;else{if(isNaN(a.checkTime))throw new Error("Must have @mediaPresentationDuration or @minimumUpdatePeriod on MPD or an explicit @duration on the last period.");b=a.checkTime}return b}},Dash.dependencies.DashMetricsExtensions=function(){"use strict";var a=function(a,b){var c,d,e,f,g,h,i,j;for(h=0;h<a.length;h+=1)for(c=a[h],e=c.AdaptationSet_asArray,i=0;i<e.length;i+=1)for(d=e[i],g=d.Representation_asArray,j=0;j<g.length;j+=1)if(f=g[j],b===f.id)return j;return-1},b=function(a,b){var c,d,e,f,g,h,i,j;for(h=0;h<a.length;h+=1)for(c=a[h],e=c.AdaptationSet_asArray,i=0;i<e.length;i+=1)for(d=e[i],g=d.Representation_asArray,j=0;j<g.length;j+=1)if(f=g[j],b===f.id)return f;return null},c=function(a,b){return this.manifestExt.getIsTypeOf(a,b)},d=function(a,b){var d,e,f,g,h,i;for(h=0;h<a.length;h+=1)for(d=a[h],f=d.AdaptationSet_asArray,i=0;i<f.length;i+=1)if(e=f[i],g=e.Representation_asArray,c.call(this,e,b))return g.length;return-1},e=function(a){var c,d=this,e=d.manifestModel.getValue(),f=e.Period_asArray;return c=b.call(d,f,a),null===c?null:c.bandwidth},f=function(b){var c,d=this,e=d.manifestModel.getValue(),f=e.Period_asArray;return c=a.call(d,f,b)},g=function(a){var b,c=this,e=c.manifestModel.getValue(),f=e.Period_asArray;return b=d.call(this,f,a)},h=function(a){if(null===a)return null;var b,c,d,e=a.RepSwitchList;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},i=function(a){if(null===a)return null;var b,c,d,e=a.BufferLevel;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},j=function(a){if(null===a)return null;var b,c,d=a.HttpList,e=null;if(null===d||d.length<=0)return null;for(b=d.length,c=b-1;c>0;){if(d[c].responsecode){e=d[c];break}c-=1}return e},k=function(a){return null===a?[]:a.HttpList?a.HttpList:[]},l=function(a){if(null===a)return null;var b,c,d,e=a.DroppedFrames;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])};return{manifestModel:void 0,manifestExt:void 0,getBandwidthForRepresentation:e,getIndexForRepresentation:f,getMaxIndexForBufferType:g,getCurrentRepresentationSwitch:h,getCurrentBufferLevel:i,getCurrentHttpRequest:j,getHttpRequests:k,getCurrentDroppedFrames:l}},Dash.dependencies.DashMetricsExtensions.prototype={constructor:Dash.dependencies.DashMetricsExtensions},Dash.dependencies.DashParser=function(){"use strict";var a=31536e3,b=2592e3,c=86400,d=3600,e=60,f=60,g=1e3,h=/^P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,i=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})([0-9]{2}))?/,j=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,k=[{type:"duration",test:function(a){return h.test(a)},converter:function(f){var g=h.exec(f);return parseFloat(g[2]||0)*a+parseFloat(g[4]||0)*b+parseFloat(g[6]||0)*c+parseFloat(g[8]||0)*d+parseFloat(g[10]||0)*e+parseFloat(g[12]||0)}},{type:"datetime",test:function(a){return i.test(a)},converter:function(a){var b,c=i.exec(a);if(b=Date.UTC(parseInt(c[1],10),parseInt(c[2],10)-1,parseInt(c[3],10),parseInt(c[4],10),parseInt(c[5],10),c[6]&&parseInt(c[6],10)||0,c[7]&&parseFloat(c[7])*g||0),c[9]&&c[10]){var d=parseInt(c[9],10)*f+parseInt(c[10],10);b+=("+"===c[8]?-1:1)*d*e*g}return new Date(b)}},{type:"numeric",test:function(a){return j.test(a)},converter:function(a){return parseFloat(a)}}],l=function(){var a,b,c,d;return d=[{name:"profiles",merge:!1},{name:"width",merge:!1},{name:"height",merge:!1},{name:"sar",merge:!1},{name:"frameRate",merge:!1},{name:"audioSamplingRate",merge:!1},{name:"mimeType",merge:!1},{name:"segmentProfiles",merge:!1},{name:"codecs",merge:!1},{name:"maximumSAPPeriod",merge:!1},{name:"startsWithSap",merge:!1},{name:"maxPlayoutRate",merge:!1},{name:"codingDependency",merge:!1},{name:"scanType",merge:!1},{name:"FramePacking",merge:!0},{name:"AudioChannelConfiguration",merge:!0},{name:"ContentProtection",merge:!0}],a={},a.name="AdaptationSet",a.isRoot=!1,a.isArray=!0,a.parent=null,a.children=[],a.properties=d,b={},b.name="Representation",b.isRoot=!1,b.isArray=!0,b.parent=a,b.children=[],b.properties=d,a.children.push(b),c={},c.name="SubRepresentation",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=d,b.children.push(c),a},m=function(){var a,b,c,d;return d=[{name:"SegmentBase",merge:!0},{name:"SegmentTemplate",merge:!0},{name:"SegmentList",merge:!0}],a={},a.name="Period",a.isRoot=!1,a.isArray=!0,a.parent=null,a.children=[],a.properties=d,b={},b.name="AdaptationSet",b.isRoot=!1,b.isArray=!0,b.parent=a,b.children=[],b.properties=d,a.children.push(b),c={},c.name="Representation",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=d,b.children.push(c),a},n=function(){var a,b,c,d,e;return e=[{name:"BaseURL",merge:!0,mergeFunction:function(a,b){var c;return c=0===b.indexOf("http://")?b:a+b}}],a={},a.name="mpd",a.isRoot=!0,a.isArray=!0,a.parent=null,a.children=[],a.properties=e,b={},b.name="Period",b.isRoot=!1,b.isArray=!0,b.parent=null,b.children=[],b.properties=e,a.children.push(b),c={},c.name="AdaptationSet",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=e,b.children.push(c),d={},d.name="Representation",d.isRoot=!1,d.isArray=!0,d.parent=c,d.children=[],d.properties=e,c.children.push(d),a},o=function(){var a=[];return a.push(l()),a.push(m()),a.push(n()),a},p=function(a,b){var c,d=new X2JS(k,"",!0),e=new ObjectIron(o()),f=new Date,g=null,h=null;try{c=d.xml_str2json(a),g=new Date,c.hasOwnProperty("BaseURL")?(c.BaseURL=c.BaseURL_asArray[0],0!==c.BaseURL.toString().indexOf("http")&&(c.BaseURL=b+c.BaseURL)):c.BaseURL=b,e.run(c),h=new Date,this.debug.log("Parsing complete: ( xml2json: "+(g.getTime()-f.getTime())+"ms, objectiron: "+(h.getTime()-g.getTime())+"ms, total: "+(h.getTime()-f.getTime())/1e3+"s)")}catch(i){return this.errHandler.manifestError("parsing the manifest failed","parse",a),null}return c};return{debug:void 0,errHandler:void 0,parse:p}},Dash.dependencies.DashParser.prototype={constructor:Dash.dependencies.DashParser},Dash.dependencies.FragmentExtensions=function(){"use strict";var a=function(a){for(var b,c,d,e,f,g,h=new DataView(a),i=0;"tfdt"!==e&&i<h.byteLength;){for(d=h.getUint32(i),i+=4,e="",f=0;4>f;f+=1)g=h.getInt8(i),e+=String.fromCharCode(g),i+=1;"moof"!==e&&"traf"!==e&&"tfdt"!==e&&(i+=d-8)}if(i===h.byteLength)throw"Error finding live offset.";return c=h.getUint8(i),this.debug.log("position: "+i),0===c?(i+=4,b=h.getUint32(i,!1)):(i+=d-16,b=utils.Math.to64BitNumber(h.getUint32(i+4,!1),h.getUint32(i,!1))),{version:c,base_media_decode_time:b}},b=function(a){for(var b,c,d,e,f,g,h,i=new DataView(a),j=0;"sidx"!==f&&j<i.byteLength;){for(g=i.getUint32(j),j+=4,f="",e=0;4>e;e+=1)h=i.getInt8(j),f+=String.fromCharCode(h),j+=1;"moof"!==f&&"traf"!==f&&"sidx"!==f?j+=g-8:"sidx"===f&&(j-=8)}return b=i.getUint8(j+8),j+=12,c=i.getUint32(j+4,!1),j+=8,d=0===b?i.getUint32(j,!1):utils.Math.to64BitNumber(i.getUint32(j+4,!1),i.getUint32(j,!1)),{earliestPresentationTime:d,timescale:c}},c=function(b){var c,d,e,f=this,g=new XMLHttpRequest,h=!1;c=b,g.onloadend=function(){h||(d="Error loading fragment: "+c,f.notify(f.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,null,new Error(d)))},g.onload=function(){h=!0,e=a(g.response),f.notify(f.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,e)},g.onerror=function(){d="Error loading fragment: "+c,f.notify(f.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,null,new Error(d))},g.responseType="arraybuffer",g.open("GET",c),g.send(null)};return{debug:void 0,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,loadFragment:c,parseTFDT:a,parseSIDX:b}},Dash.dependencies.FragmentExtensions.prototype={constructor:Dash.dependencies.FragmentExtensions},Dash.dependencies.RepresentationController=function(){"use strict";var a,b=null,c=-1,d=!0,e=[],f=function(c,f,i){var j=this;d=!0,j.notify(j.eventList.ENAME_DATA_UPDATE_STARTED),e=h.call(j,c,f),a=g.call(j,j.abrController.getQualityFor(i)),b=c;for(var k=0;k<e.length;k+=1)j.indexHandler.updateRepresentation(e[k])},g=function(a){return e[a]},h=function(a,b){var d,e,f=this,g=f.manifestModel.getValue();return c=f.manifestExt.getDataIndex(a,g,b.index),e=f.manifestExt.getAdaptationsForPeriod(g,b),d=f.manifestExt.getRepresentationsForAdaptation(g,e[c])},i=function(c,e){e===a&&(d=!1,this.notify(this.eventList.ENAME_DATA_UPDATE_COMPLETED,b,a))},j=function(a,b){for(var c,d=this,f=0,g=e.length;g>f;f+=1)c=e[f],c.segmentAvailabilityRange=d.timelineConverter.calcSegmentAvailabilityRange(c,b)},k=function(b,c,d,e){var f=this;c===f.streamProcessor.getType()&&(a=f.getRepresentationForQuality(e))};return{system:void 0,debug:void 0,manifestExt:void 0,manifestModel:void 0,bufferExt:void 0,abrController:void 0,timelineConverter:void 0,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this.qualityChanged=k,this.representationUpdated=i,this.wallclockTimeUpdated=j},initialize:function(a){this.streamProcessor=a,this.indexHandler=a.indexHandler},getData:function(){return b},getDataIndex:function(){return c},isUpdating:function(){return d},updateData:f,getRepresentationForQuality:g,getCurrentRepresentation:function(){return a}}},Dash.dependencies.RepresentationController.prototype={constructor:Dash.dependencies.RepresentationController},Dash.dependencies.TimelineConverter=function(){"use strict";var a=function(a,b,c,d){var e=0/0;return e=d?c&&b.timeShiftBufferDepth!=Number.POSITIVE_INFINITY?new Date(b.availabilityStartTime.getTime()+1e3*(a+b.timeShiftBufferDepth)):b.availabilityEndTime:c?new Date(b.availabilityStartTime.getTime()+1e3*a):b.availabilityStartTime},b=function(b,c,d){return a.call(this,b,c,d)},c=function(b,c,d){return a.call(this,b,c,d,!0)},d=function(a){var b,c;return c="dynamic"===a.mpd.manifest.type,b=c?a.liveEdge:a.start},e=function(a,c,d){var e=b.call(this,c.start,c.mpd,d);return(a.getTime()-e.getTime())/1e3},f=function(a,b){var c=b.adaptation.period.start,d=b.presentationTimeOffset;return c-d+a},g=function(a,b){var c=b.adaptation.period.start,d=b.presentationTimeOffset;return c+d+a},h=function(a,b){var c,d,e;return b&&(c=a.representation.adaptation.period.mpd.suggestedPresentationDelay,d=a.presentationStartTime+c,e=new Date(a.availabilityStartTime.getTime()+1e3*d)),e},i=function(a,b,c){var d,e=this,f=e.calcSegmentAvailabilityRange(a,c);return b>=f.start&&b<=f.end?b:d=Math.max(f.end-2*a.adaptation.period.mpd.manifest.minBufferTime,f.start)},j=function(a,b){var c,d,f=1e3*a.adaptation.period.clientServerTimeShift,g=a.segmentDuration,h=0,i=a.adaptation.period.duration,j={start:h,end:i};return b?a.adaptation.period.isClientServerTimeSyncCompleted&&!isNaN(g)||!a.segmentAvailabilityRange?(c=a.adaptation.period.mpd.checkTime,d=e(new Date((new Date).getTime()+f),a.adaptation.period,b),h=Math.max(d-a.adaptation.period.mpd.timeShiftBufferDepth-g,0),c-=g,d-=g,i=isNaN(c)?d:Math.min(c,d),j={start:h,end:i}):a.segmentAvailabilityRange:j},k=function(a,b,c){c.isClientServerTimeSyncCompleted||(c.clientServerTimeShift=b-c.liveEdge,c.isClientServerTimeSyncCompleted=!0)},l=function(a){var b=a.adaptation.period.start,c=a.presentationTimeOffset;return b-c};return{notifier:void 0,setup:function(){this.liveEdgeFound=k},calcAvailabilityStartTimeFromPresentationTime:b,calcAvailabilityEndTimeFromPresentationTime:c,calcPresentationTimeFromWallTime:e,calcPresentationTimeFromMediaTime:f,calcPresentationStartTime:d,calcActualPresentationTime:i,calcMediaTimeFromPresentationTime:g,calcSegmentAvailabilityRange:j,calcWallTimeForSegment:h,calcMSETimeOffset:l}},Dash.dependencies.TimelineConverter.prototype={constructor:Dash.dependencies.TimelineConverter},Dash.vo.AdaptationSet=function(){"use strict";this.period=null,this.index=-1},Dash.vo.AdaptationSet.prototype={constructor:Dash.vo.AdaptationSet},Dash.vo.Mpd=function(){"use strict";this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.checkTime=0/0},Dash.vo.Mpd.prototype={constructor:Dash.vo.Mpd},Dash.vo.Period=function(){"use strict";this.id=null,this.index=-1,this.duration=0/0,this.start=0/0,this.mpd=null,this.liveEdge=0/0,this.isClientServerTimeSyncCompleted=!1,this.clientServerTimeShift=0},Dash.vo.Period.prototype={constructor:Dash.vo.Period},Dash.vo.Representation=function(){"use strict";this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.segmentDuration=0/0,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=0/0,this.segmentAvailabilityRange=null,this.availableSegmentsNumber=0},Dash.vo.Representation.prototype={constructor:Dash.vo.Representation},Dash.vo.Segment=function(){"use strict";this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=0/0,this.replacementTime=null,this.replacementNumber=0/0,this.mediaStartTime=0/0,this.presentationStartTime=0/0,this.availabilityStartTime=0/0,this.availabilityEndTime=0/0,this.availabilityIdx=0/0,this.wallStartTime=0/0,this.representation=null},Dash.vo.Segment.prototype={constructor:Dash.vo.Segment},MediaPlayer.dependencies.AbrController=function(){"use strict";var a=!0,b={},c={},d={},e=function(a){var b;return c.hasOwnProperty(a)||(c[a]=0),b=c[a]},f=function(a,b){c[a]=b},g=function(a){var b;return d.hasOwnProperty(a)||(d[a]=0),b=d[a]},h=function(a,b){d[a]=b},i=function(a,c){b[a]=c},j=function(a){var c;return b.hasOwnProperty(a)||(b[a]=0),c=b[a]},k=function(a,b){var c,d=this,e=a.streamProcessor.getType();c=d.manifestExt.getRepresentationCount(b)-1,j(e)!==c&&(i(e,c),d.notify(d.eventList.ENAME_TOP_QUALITY_INDEX_CHANGED,e,c))},l=function(a,b){var c=this,d=b.getContext().streamProcessor.getType(),e=b.getContext().streamProcessor.getData();c.getPlaybackQuality(d,e)};return{debug:void 0,abrRulesCollection:void 0,manifestExt:void 0,metricsModel:void 0,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this.scheduledTimeOccurred=l,this.dataUpdateCompleted=k},getAutoSwitchBitrate:function(){return a},setAutoSwitchBitrate:function(b){a=b},getMetricsFor:function(a){var b,c=this;return b=c.metricsModel.getMetricsFor(c.manifestExt.getIsVideo(a)?"video":c.manifestExt.getIsAudio(a)?"audio":"stream")},getPlaybackQuality:function(b,c){var d,i,k,l,m,n,o,p,q,r,s=this,t=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,u=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE;if(m=e(b),r=g(b),!a)return s.debug.log("Unchanged quality of "+m),{quality:m,confidence:r};for(p=s.getMetricsFor(c),q=s.abrRulesCollection.getRules(),l={},l[MediaPlayer.rules.SwitchRequest.prototype.STRONG]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,l[MediaPlayer.rules.SwitchRequest.prototype.WEAK]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,l[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,d=0,i=q.length;i>d;d+=1)k=q[d].checkIndex(m,p,c),k.quality!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(l[k.priority]=Math.min(l[k.priority],k.quality));return l[MediaPlayer.rules.SwitchRequest.prototype.WEAK]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(u=MediaPlayer.rules.SwitchRequest.prototype.WEAK,t=l[MediaPlayer.rules.SwitchRequest.prototype.WEAK]),l[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(u=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,t=l[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]),l[MediaPlayer.rules.SwitchRequest.prototype.STRONG]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(u=MediaPlayer.rules.SwitchRequest.prototype.STRONG,t=l[MediaPlayer.rules.SwitchRequest.prototype.STRONG]),t!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&void 0!==t&&(m=t),u!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&void 0!==u&&(r=u),o=j(b),0>m&&(m=0),m>o&&(m=o),r!=MediaPlayer.rules.SwitchRequest.prototype.STRONG&&r!=MediaPlayer.rules.SwitchRequest.prototype.WEAK&&(r=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT),n=e(b),m!==n&&s.notify(s.eventList.ENAME_QUALITY_CHANGED,b,n,m),f(b,m),h(b,r),{quality:m,confidence:r}},setPlaybackQuality:function(a,b){var c=e(a);b!==c&&(f(a,b),this.notify(this.eventList.ENAME_QUALITY_CHANGED,a,c,b))},getQualityFor:function(a){return e(a)},getConfidenceFor:function(a){return g(a)}}},MediaPlayer.dependencies.AbrController.prototype={constructor:MediaPlayer.dependencies.AbrController},MediaPlayer.dependencies.BufferController=function(){"use strict";var a,b,c,d=.5,e=22,f=[],g=-1,h=0,i=0,j=!1,k=0,l=!1,m=-1,n=-1,o=null,p=null,q=!1,r=!1,s=0,t=[],u=function(){return null!==s},v=function(a,c,d,e){var g=this;c===g.streamProcessor.getFragmentModel()&&(g.debug.log("Initialization finished loading: "+b),f[e]=d,e===h&&u()&&Q.call(g))},w=function(a,b,c,d,e){b===this.streamProcessor.getFragmentModel()&&(t.push({bytes:c,quality:d,index:e}),M.call(this))},x=function(a,c,d){r=!0;var f,g=this,h=function(a,h,i){if(i)return i.code===e&&(t.unshift({bytes:h,quality:c,index:d}),l=!0,g.notify(g.eventList.ENAME_QUOTA_EXCEEDED,d)),void(r=!1);if(l=!1,F.call(g)){if(y.call(g),f=g.sourceBufferExt.getAllRanges(o),f&&f.length>0){var j,k;for(j=0,k=f.length;k>j;j+=1)g.debug.log("Buffered "+b+" Range: "+f.start(j)+" - "+f.end(j))}I.call(g,c,d),g.notify(g.eventList.ENAME_BYTES_APPENDED,d)}};F.call(g)&&A.call(g,function(){return c!==i&&void 0!==d?void J.call(g,c,d):void(F.call(g)&&(g.sourceBufferExt.subscribe(g.sourceBufferExt.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,g,h,!0),g.sourceBufferExt.append(o,a)))})},y=function(){if(!F.call(this))return!1;var a,b=this,c=b.playbackController.getTime();return a=b.sourceBufferExt.getBufferLength(o,c),F.call(b)?(k=a,b.notify(b.eventList.ENAME_BUFFER_LEVEL_UPDATED,k),z.call(b),D.call(b),d>k&&E.call(b,!1),!0):!1},z=function(){var a=this.bufferExt.getLeastBufferLevel(),b=2*c,d=k-a;d>=b&&!q?(q=!0,this.notify(this.eventList.ENAME_BUFFER_LEVEL_OUTRUN)):b>d&&q&&(this.notify(this.eventList.ENAME_BUFFER_LEVEL_BALANCED),q=!1,M.call(this))},A=function(a){var b,d=this,e=0;return l?(b=function(){B.call(d,function(f){e+=f,e>=c?a.call(d):setTimeout(b,1e3*c)})},void b.call(d)):void a.call(d)},B=function(b){var c,d,e,f=this,h=f.playbackController.getTime(),i=0,j=function(a,c,d){f.notify(f.eventList.ENAME_BUFFER_CLEARED,c,d),b.call(f,d-c)};e=f.fragmentController.getExecutedRequestForTime(f.streamProcessor.getFragmentModel(),h),c=e&&!isNaN(e.startTime)?e.startTime:Math.floor(h),d=f.sourceBufferExt.getBufferRange(o,h),null===d&&g===h&&o.buffered.length>0&&(c=o.buffered.end(o.buffered.length-1)),i=o.buffered.start(0),f.sourceBufferExt.subscribe(f.sourceBufferExt.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,f,j,!0),f.sourceBufferExt.remove(o,i,c,a)},C=function(){var a=m===n-1;a&&!j&&(j=!0,this.notify(this.eventList.ENAME_BUFFERING_COMPLETED))},D=function(){var a=this.playbackController.getTimeToPeriodEnd();c>k&&(a>c||c>=a&&!j)?E.call(this,!1):E.call(this,!0)},E=function(a){p!==a&&(p=a,this.debug.log(p?"Got enough "+b+" buffer to start.":"Waiting for more "+b+" buffer before starting playback."),this.notify(this.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,a))},F=function(){return!!this.representationController&&!!this.representationController.getData()&&!!o},G=function(a){o.timestampOffset!==a&&(o.timestampOffset=a)},H=function(){var a=this;l?M.call(a):y.call(a)},I=function(a,b){r=!1,void 0!==b?L.call(this,b):K.call(this,a)},J=function(a,b){r=!1,this.notify(this.eventList.ENAME_BYTES_REJECTED,a,b),u()?Q.call(this):M.call(this)},K=function(a){i=a,i===s?s=null:Q.call(this)},L=function(a){m=Math.max(a,m),C.call(this),u()?Q.call(this):M.call(this)},M=function(){var a;0===t.length||q||r||u()||(a=t.shift(),x.call(this,a.bytes,a.quality,a.index))},N=function(a,b,d){var e,f=this;G.call(f,d.MSETimeOffset),e=f.bufferExt.decideBufferLength(f.manifestModel.getValue().minBufferTime,f.playbackController.getPeriodDuration()),c!==e&&(f.setMinBufferTime(e),f.notify(f.eventList.ENAME_MIN_BUFFER_TIME_UPDATED,e))},O=function(a,b,c){var d=this;b===d.streamProcessor.getFragmentModel()&&(n=c.index,C.call(d))},P=function(a,c,d,e){if(b===c){var f=this;h!==e&&(G.call(f,f.representationController.getRepresentationForQuality(e).MSETimeOffset),h=e,s=e,Q.call(f))}},Q=function(){var a=this;if(f[h]){if(r)return;x.call(a,f[h],h)}else a.notify(a.eventList.ENAME_INIT_REQUESTED,h)},R=function(){D.call(this)},S=function(a,c){var d=this;b===c.getContext().streamProcessor.getType()&&D.call(d)};return{manifestExt:void 0,manifestModel:void 0,bufferExt:void 0,sourceBufferExt:void 0,debug:void 0,system:void 0,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this.dataUpdateCompleted=N,this.initSegmentLoaded=v,this.mediaSegmentLoaded=w,this.streamCompleted=O,this.scheduledTimeOccurred=S,this.qualityChanged=P,this.playbackProgress=H,this.playbackSeeking=H,this.playbackTimeUpdated=H,this.playbackRateChanged=R},initialize:function(a,c,d,e){var f=this;b=a,f.setMediaSource(d),f.setBuffer(c),f.streamProcessor=e,f.fragmentController=e.fragmentController,f.scheduleController=e.scheduleController,f.representationController=e.representationController,f.playbackController=e.playbackController},getStreamProcessor:function(){return this.streamProcessor},setStreamProcessor:function(a){this.streamProcessor=a},getBuffer:function(){return o},setBuffer:function(a){o=a},getBufferLevel:function(){return k},getMinBufferTime:function(){return c},setMinBufferTime:function(a){c=a},setMediaSource:function(b){a=b},isBufferingCompleted:function(){return j},reset:function(b){var c=this;f=[],l=!1,p=null,q=!1,r=!1,s=0,t=[],b||(c.sourceBufferExt.abort(a,o),c.sourceBufferExt.removeSourceBuffer(a,o)),o=null}}},MediaPlayer.dependencies.BufferController.prototype={constructor:MediaPlayer.dependencies.BufferController},MediaPlayer.dependencies.BufferExtensions=function(){"use strict";var a,b,c=0,d=0,e=function(a){var b=this.metricsExt.getCurrentHttpRequest(a);return null!==b?(b.tresponse.getTime()-b.trequest.getTime())/1e3:0},f=function(){var a,b=this,e=b.abrController.getQualityFor("audio"),f=b.abrController.getConfidenceFor("audio"),g=b.abrController.getQualityFor("video"),h=b.abrController.getConfidenceFor("video");return a=e===c&&g===d,a=a||f===MediaPlayer.rules.SwitchRequest.prototype.STRONG&&h===MediaPlayer.rules.SwitchRequest.prototype.STRONG},g=function(a,b,e){"audio"===b?c=e:"video"===b&&(d=e)};return{system:void 0,manifestExt:void 0,metricsExt:void 0,metricsModel:void 0,abrController:void 0,bufferMax:void 0,setup:function(){this.topQualityIndexChanged=g},getTopQualityIndex:function(a){var b=null;return"audio"===a?b=c:"video"===a&&(b=d),b},decideBufferLength:function(b,c){return a=isNaN(c)||MediaPlayer.dependencies.BufferExtensions.DEFAULT_MIN_BUFFER_TIME<c&&c>b?Math.max(MediaPlayer.dependencies.BufferExtensions.DEFAULT_MIN_BUFFER_TIME,b):b>=c?Math.min(c,MediaPlayer.dependencies.BufferExtensions.DEFAULT_MIN_BUFFER_TIME):Math.min(c,b)},getLeastBufferLevel:function(){var a=this.metricsModel.getReadOnlyMetricsFor("video"),b=this.metricsExt.getCurrentBufferLevel(a),c=this.metricsModel.getReadOnlyMetricsFor("audio"),d=this.metricsExt.getCurrentBufferLevel(c),e=null;return e=null===b||null===d?null!==d?d.level:null!==b?b.level:null:Math.min(d.level,b.level)},getRequiredBufferLength:function(c,d,g,h){var i=this,j=i.metricsModel.getReadOnlyMetricsFor("video"),k=i.metricsModel.getReadOnlyMetricsFor("audio"),l=h>=MediaPlayer.dependencies.BufferExtensions.LONG_FORM_CONTENT_DURATION_THRESHOLD,m=!1,n=0;return i.bufferMax===MediaPlayer.dependencies.BufferExtensions.BUFFER_SIZE_MIN?n=a:i.bufferMax===MediaPlayer.dependencies.BufferExtensions.BUFFER_SIZE_INFINITY?n=h:i.bufferMax===MediaPlayer.dependencies.BufferExtensions.BUFFER_SIZE_REQUIRED&&(b=a,g||c||(m=f.call(i)),m&&(b=l?MediaPlayer.dependencies.BufferExtensions.BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM:MediaPlayer.dependencies.BufferExtensions.BUFFER_TIME_AT_TOP_QUALITY),n=b+d+Math.max(e.call(i,j),e.call(i,k))),n},getBufferTarget:function(){return void 0===b?a:b}}},MediaPlayer.dependencies.BufferExtensions.BUFFER_SIZE_REQUIRED="required",MediaPlayer.dependencies.BufferExtensions.BUFFER_SIZE_MIN="min",MediaPlayer.dependencies.BufferExtensions.BUFFER_SIZE_INFINITY="infinity",MediaPlayer.dependencies.BufferExtensions.BUFFER_TIME_AT_STARTUP=1,MediaPlayer.dependencies.BufferExtensions.DEFAULT_MIN_BUFFER_TIME=8,MediaPlayer.dependencies.BufferExtensions.BUFFER_TIME_AT_TOP_QUALITY=30,MediaPlayer.dependencies.BufferExtensions.BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM=300,MediaPlayer.dependencies.BufferExtensions.LONG_FORM_CONTENT_DURATION_THRESHOLD=600,MediaPlayer.dependencies.BufferExtensions.prototype.constructor=MediaPlayer.dependencies.BufferExtensions,MediaPlayer.utils.Capabilities=function(){"use strict"
},MediaPlayer.utils.Capabilities.prototype={constructor:MediaPlayer.utils.Capabilities,supportsMediaSource:function(){"use strict";var a="WebKitMediaSource"in window,b="MediaSource"in window;return a||b},supportsMediaKeys:function(){"use strict";var a="WebKitMediaKeys"in window,b="MSMediaKeys"in window,c="MediaKeys"in window;return a||b||c},supportsCodec:function(a,b){"use strict";if(!(a instanceof HTMLVideoElement))throw"element must be of type HTMLVideoElement.";var c=a.canPlayType(b);return"probably"===c}},MediaPlayer.utils.Debug=function(){"use strict";var a=!0;return{eventBus:void 0,setLogToBrowserConsole:function(b){a=b},getLogToBrowserConsole:function(){return a},log:function(b){a&&console.log(b),this.eventBus.dispatchEvent({type:"log",message:b})}}},MediaPlayer.dependencies.ErrorHandler=function(){"use strict";return{eventBus:void 0,capabilityError:function(a){this.eventBus.dispatchEvent({type:"error",error:"capability",event:a})},downloadError:function(a,b,c){this.eventBus.dispatchEvent({type:"error",error:"download",event:{id:a,url:b,request:c}})},manifestError:function(a,b,c){this.eventBus.dispatchEvent({type:"error",error:"manifestError",event:{message:a,id:b,manifest:c}})},closedCaptionsError:function(a,b,c){this.eventBus.dispatchEvent({type:"error",error:"cc",event:{message:a,id:b,cc:c}})},mediaSourceError:function(a){this.eventBus.dispatchEvent({type:"error",error:"mediasource",event:a})},mediaKeySessionError:function(a){this.eventBus.dispatchEvent({type:"error",error:"key_session",event:a})},mediaKeyMessageError:function(a){this.eventBus.dispatchEvent({type:"error",error:"key_message",event:a})},mediaKeySystemSelectionError:function(a){this.eventBus.dispatchEvent({type:"error",error:"key_system_selection",event:a})}}},MediaPlayer.dependencies.ErrorHandler.prototype={constructor:MediaPlayer.dependencies.ErrorHandler},MediaPlayer.utils.EventBus=function(){"use strict";var a,b=function(b,c){var d=(c?"1":"0")+b;return d in a||(a[d]=[]),a[d]},c=function(){a={}};return c(),{addEventListener:function(a,c,d){var e=b(a,d),f=e.indexOf(c);-1===f&&e.push(c)},removeEventListener:function(a,c,d){var e=b(a,d),f=e.indexOf(c);-1!==f&&e.splice(f,1)},dispatchEvent:function(a){for(var c=b(a.type,!1).slice(),d=0;d<c.length;d++)c[d].call(this,a);return!a.defaultPrevented}}},MediaPlayer.dependencies.FragmentController=function(){"use strict";var a=[],b=function(b){for(var c=a.length,d=0;c>d;d++)if(a[d].getContext()==b)return a[d];return null},c=function(){h.call(this)&&i.call(this)},d=function(a,b){var c=this;c.isInitializationRequest(b)?c.notify(c.eventList.ENAME_INIT_SEGMENT_LOADING_START,a,b):c.notify(c.eventList.ENAME_MEDIA_SEGMENT_LOADING_START,a,b)},e=function(a,b,c){var d=this,e=d.process(c);return null===e?void d.debug.log("No "+b.streamType+" bytes to push."):void(d.isInitializationRequest(b)?d.notify(d.eventList.ENAME_INIT_SEGMENT_LOADED,a,e,b.quality):d.notify(d.eventList.ENAME_MEDIA_SEGMENT_LOADED,a,e,b.quality,b.index))},f=function(a,b){this.notify(this.eventList.ENAME_STREAM_COMPLETED,a,b)},g=function(){c.call(this)},h=function(){for(var b=!0,c=a.length,d=0;c>d;d++)if(!a[d].isReady()){b=!1;break}return b},i=function(){for(var b=0;b<a.length;b++)a[b].executeCurrentRequest()};return{system:void 0,debug:void 0,fragmentLoader:void 0,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this.fragmentLoadingStarted=d,this.fragmentLoadingCompleted=e,this.streamCompleted=f,this.bufferLevelBalanced=g},process:function(a){var b=null;return null!==a&&void 0!==a&&a.byteLength>0&&(b=new Uint8Array(a)),b},getModel:function(c){if(!c)return null;var d=b(c);return d||(d=this.system.getObject("fragmentModel"),d.setContext(c),a.push(d)),d},detachModel:function(b){var c=a.indexOf(b);c>-1&&a.splice(c,1)},onStateChange:function(){c.call(this)},isFragmentLoadedOrPending:function(a,c){var d,e=b(a);return e?d=e.isFragmentLoadedOrPending(c):!1},getPendingRequests:function(a){var c=b(a);return c?c.getPendingRequests():null},getLoadingRequests:function(a){var c=b(a);return c?c.getLoadingRequests():null},isInitializationRequest:function(a){return a&&a.type&&"initialization segment"===a.type.toLowerCase()},getLoadingTime:function(a){var c=b(a);return c?c.getLoadingTime():null},getExecutedRequestForTime:function(a,b){return a?a.getExecutedRequestForTime(b):null},removeExecutedRequest:function(a,b){a&&a.removeExecutedRequest(b)},removeExecutedRequestsBeforeTime:function(a,b){a&&a.removeExecutedRequestsBeforeTime(b)},cancelPendingRequestsForModel:function(a){a&&a.cancelPendingRequests()},abortRequestsForModel:function(a){a&&a.abortRequests()},prepareFragmentForLoading:function(a,c){var d=b(a);return d&&c?(d.addRequest(c),!0):!1},resetModel:function(a){this.abortRequestsForModel(a),this.cancelPendingRequestsForModel(a)}}},MediaPlayer.dependencies.FragmentController.prototype={constructor:MediaPlayer.dependencies.FragmentController},MediaPlayer.dependencies.FragmentLoader=function(){"use strict";var a=3,b=500,c=[],d=function(a,e){var f=new XMLHttpRequest,g=null,h=!0,i=!0,j=null,k=this;c.push(f),a.requestStartDate=new Date,g=k.metricsModel.addHttpRequest(a.streamType,null,a.type,a.url,null,a.range,a.requestStartDate,null,null,null,null,a.duration),k.metricsModel.appendHttpTrace(g,a.requestStartDate,a.requestStartDate.getTime()-a.requestStartDate.getTime(),[0]),j=a.requestStartDate,f.open("GET",a.url,!0),f.responseType="arraybuffer",a.range&&f.setRequestHeader("Range","bytes="+a.range),f.onprogress=function(b){var c=new Date;h&&(h=!1,(!b.lengthComputable||b.lengthComputable&&b.total!=b.loaded)&&(a.firstByteDate=c,g.tresponse=c)),k.metricsModel.appendHttpTrace(g,c,c.getTime()-j.getTime(),[f.response?f.response.byteLength:0]),j=c},f.onload=function(){if(!(f.status<200||f.status>299)){i=!1;var b,c,d=new Date,e=f.response;a.firstByteDate||(a.firstByteDate=a.requestStartDate),a.requestEndDate=d,b=a.firstByteDate.getTime()-a.requestStartDate.getTime(),c=a.requestEndDate.getTime()-a.firstByteDate.getTime(),k.debug.log("loaded "+a.streamType+":"+a.type+":"+a.startTime+" ("+f.status+", "+b+"ms, "+c+"ms)"),g.tresponse=a.firstByteDate,g.tfinish=a.requestEndDate,g.responsecode=f.status,k.metricsModel.appendHttpTrace(g,d,d.getTime()-j.getTime(),[e?e.byteLength:0]),j=d,k.notify(k.eventList.ENAME_LOADING_COMPLETED,a,e)}},f.onloadend=f.onerror=function(){if(-1!==c.indexOf(f)&&(c.splice(c.indexOf(f),1),i)){i=!1;var h,l,m=new Date,n=f.response;a.firstByteDate||(a.firstByteDate=a.requestStartDate),a.requestEndDate=m,h=a.firstByteDate.getTime()-a.requestStartDate.getTime(),l=a.requestEndDate.getTime()-a.firstByteDate.getTime(),k.debug.log("failed "+a.streamType+":"+a.type+":"+a.startTime+" ("+f.status+", "+h+"ms, "+l+"ms)"),g.tresponse=a.firstByteDate,g.tfinish=a.requestEndDate,g.responsecode=f.status,k.metricsModel.appendHttpTrace(g,m,m.getTime()-j.getTime(),[n?n.byteLength:0]),j=m,e>0?(k.debug.log("Failed loading segment: "+a.streamType+":"+a.type+":"+a.startTime+", retry in "+b+"ms attempts: "+e),e--,setTimeout(function(){d.call(k,a,e)},b)):(k.debug.log("Failed loading segment: "+a.streamType+":"+a.type+":"+a.startTime+" no retry attempts left"),k.errHandler.downloadError("content",a.url,f),k.notify(k.eventList.ENAME_LOADING_COMPLETED,a,null,new Error("failed loading segment")))}},f.send()},e=function(a){var b=this,c=new XMLHttpRequest,d=!1;c.open("HEAD",a.url,!0),c.onload=function(){c.status<200||c.status>299||(d=!0,b.notify(b.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,!0,a))},c.onloadend=c.onerror=function(){d||b.notify(b.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,!1,a)},c.send()};return{metricsModel:void 0,errHandler:void 0,debug:void 0,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,load:function(b){b?d.call(this,b,a):this.notify(this.eventList.ENAME_LOADING_COMPLETED,b,null,new Error("request is null"))},checkForExistence:function(a){return a?void e.call(this,a):void this.notify(this.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,!1,a)},abort:function(){var a,b,d=c.length;for(a=0;d>a;a+=1)b=c[a],c[a]=null,b.abort(),b=null;c=[]}}},MediaPlayer.dependencies.FragmentLoader.prototype={constructor:MediaPlayer.dependencies.FragmentLoader},MediaPlayer.dependencies.FragmentModel=function(){"use strict";var a,b=[],c=[],d=[],e=2,f=!1,g=function(a){var b=this;b.notify(b.eventList.ENAME_FRAGMENT_LOADING_STARTED,a),b.fragmentLoader.load(a)},h=function(a,b){var c=function(a,c){return a[b]<c[b]?-1:a[b]>c[b]?1:0};a.sort(c)},i=function(a){var c=b.indexOf(a);-1!==c&&b.splice(c,1)},j=function(a,c,e,f){e&&!f?(d.splice(d.indexOf(c),1),b.push(c),this.notify(this.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,c,e)):(d.splice(d.indexOf(c),1),this.notify(this.eventList.ENAME_FRAGMENT_LOADING_FAILED,c))},k=function(){f=!0},l=function(){f=!1};return{system:void 0,debug:void 0,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this.bufferLevelOutrun=k,this.bufferLevelBalanced=l,this.loadingCompleted=j},setLoader:function(a){this.fragmentLoader=a},setContext:function(b){a=b},getContext:function(){return a},addRequest:function(a){a&&(c.push(a),h.call(this,c,"index"))},isFragmentLoadedOrPending:function(a){for(var e,f=!1,g=b.length,h=0;g>h;h++)if(e=b[h],a.startTime===e.startTime||"complete"===e.action&&a.action===e.action){if(a.url===e.url){f=!0;break}i(a)}if(!f)for(h=0,g=c.length;g>h;h+=1)e=c[h],a.url===e.url&&a.startTime===e.startTime&&(f=!0);if(!f)for(h=0,g=d.length;g>h;h+=1)e=d[h],a.url===e.url&&a.startTime===e.startTime&&(f=!0);return f},isReady:function(){return a.isReady()},getPendingRequests:function(){return c},getLoadingRequests:function(){return d},getLoadingTime:function(){var a,c,d=0;for(c=b.length-1;c>=0;c-=1)if(a=b[c],a.requestEndDate instanceof Date&&a.firstByteDate instanceof Date){d=a.requestEndDate.getTime()-a.firstByteDate.getTime();break}return d},getExecutedRequestForTime:function(a){var c,d=b.length-1,e=0/0,f=0/0,g=null;for(c=d;c>=0;c-=1)if(g=b[c],e=g.startTime,f=e+g.duration,!isNaN(e)&&!isNaN(f)&&a>e&&f>a)return g;return null},getExecutedRequestForQualityAndIndex:function(a,c){var d,e=b.length-1,f=null;for(d=e;d>=0;d-=1)if(f=b[d],f.quality===a&&f.index===c)return f;return null},removeExecutedRequest:function(a){i.call(this,a)},removeExecutedRequestsBeforeTime:function(a){var c,d=b.length-1,e=0/0,f=null;for(c=d;c>=0;c-=1)f=b[c],e=f.startTime,!isNaN(e)&&a>e&&i.call(this,f)},cancelPendingRequests:function(){c=[]},abortRequests:function(){this.fragmentLoader.abort();for(var a=0,b=d.length;b>a;a+=1)this.removeExecutedRequest(d[a]);d=[]},executeCurrentRequest:function(){var a,h=this;if(!(0===c.length||f||d.length>=e))switch(a=c.shift(),a.action){case"complete":b.push(a),h.notify(h.eventList.ENAME_STREAM_COMPLETED,a);break;case"download":d.push(a),g.call(h,a);break;default:this.debug.log("Unknown request action.")}}}},MediaPlayer.dependencies.FragmentModel.prototype={constructor:MediaPlayer.dependencies.FragmentModel},MediaPlayer.dependencies.LiveEdgeFinder=function(){"use strict";var a=43200,b=!1,c=0/0,d=null,e=0/0,f=null,g=!1,h=0/0,i=function(){var g,i,m=this;f=m.streamProcessor.getCurrentRepresentation(),h=f.segmentDuration,i=f.segmentAvailabilityRange,c=i.end,d={start:Math.max(0,c-a),end:c+a},e=Math.floor((i.end-i.start)/2),g=m.indexHandler.getSegmentRequestForTime(f,c),j.call(m,c,l,k,g),b=!0},j=function(a,b,c,d){var g,h=this;if(null===d)f.segments=null,f.segmentAvailabilityRange={start:a-e,end:a+e},g=h.indexHandler.getSegmentRequestForTime(f,a),j.call(h,a,b,c,g);else{var i=function(d,e,f){h.fragmentLoader.unsubscribe(h.fragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,h,i),e?b.call(h,f,a):c.call(h,f,a)};h.fragmentLoader.subscribe(h.fragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,h,i),h.fragmentLoader.checkForExistence(d)}},k=function(a,b){var h,i,n;return g?void m.call(this,!1,b):(n=b-c,h=n>0?c-n:c+Math.abs(n)+e,void(h<d.start&&h>d.end?this.notify(this.eventList.ENAME_FRAGMENT_LOADING_FAILED,a):(i=this.indexHandler.getSegmentRequestForTime(f,h),j.call(this,h,l,k,i))))},l=function(a,b){var i,k,l=a.startTime,n=this;if(!g){if(!h)return void n.notify(n.eventList.ENAME_LIVE_EDGE_FOUND,l,f.adaptation.period);if(g=!0,d.end=l+2*e,b===c)return k=b+h,i=this.indexHandler.getSegmentRequestForTime(f,k),void j.call(n,k,function(){m.call(n,!0,k)},function(){n.notify(n.eventList.ENAME_LIVE_EDGE_FOUND,k,f.adaptation.period)},i)}m.call(this,!0,b)},m=function(a,b){var c,e,g;a?d.start=b:d.end=b,c=Math.floor(d.end-d.start)<=h,c?this.notify(this.eventList.ENAME_LIVE_EDGE_FOUND,a?b:b-h,f.adaptation.period):(g=(d.start+d.end)/2,e=this.indexHandler.getSegmentRequestForTime(f,g),j.call(this,g,l,k,e))},n=function(){this.streamProcessor.isDynamic()&&!b&&i.call(this)};return{system:void 0,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this.dataUpdateCompleted=n},initialize:function(a){this.streamProcessor=a,this.indexHandler=a.indexHandler,this.fragmentLoader=a.fragmentLoader},abortSearch:function(){b=!1,c=0/0,d=null,e=0/0,f=null,g=!1,h=0/0}}},MediaPlayer.dependencies.LiveEdgeFinder.prototype={constructor:MediaPlayer.dependencies.LiveEdgeFinder},MediaPlayer.dependencies.ManifestLoader=function(){"use strict";var a=3,b=500,c=function(a){var b=null;return-1!==a.indexOf("/")&&(b=a.substring(0,a.lastIndexOf("/")+1)),b},d=function(a,e){var f,g=c(a),h=new XMLHttpRequest,i=new Date,j=null,k=!0,l=null,m=null,n=this;l=function(){h.status<200||h.status>299||(k=!1,j=new Date,n.metricsModel.addHttpRequest("stream",null,"MPD",a,null,null,i,j,h.status,null,null),f=n.parser.parse(h.responseText,g),f?(f.mpdUrl=a,f.mpdLoadedTime=j,n.notify(n.eventList.ENAME_MANIFEST_LOADED,f)):n.notify(n.eventList.ENAME_MANIFEST_LOADED,null,new Error("Failed loading manifest: "+a)))},m=function(){k&&(k=!1,n.metricsModel.addHttpRequest("stream",null,"MPD",a,null,null,i,new Date,h.status,null,null),e>0?(n.debug.log("Failed loading manifest: "+a+", retry in "+b+"ms attempts: "+e),e--,setTimeout(function(){d.call(n,a,e)},b)):(n.debug.log("Failed loading manifest: "+a+" no retry attempts left"),n.errHandler.downloadError("manifest",a,h),n.notify(n.eventList.ENAME_MANIFEST_LOADED,null,new Error("Failed loading manifest: "+a+" no retry attempts left"))))};try{h.onload=l,h.onloadend=m,h.onerror=m,h.open("GET",a,!0),h.send()}catch(o){h.onerror()}};return{debug:void 0,parser:void 0,errHandler:void 0,metricsModel:void 0,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,load:function(b){d.call(this,b,a)}}},MediaPlayer.dependencies.ManifestLoader.prototype={constructor:MediaPlayer.dependencies.ManifestLoader},MediaPlayer.models.ManifestModel=function(){"use strict";var a;return{system:void 0,eventBus:void 0,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,getValue:function(){return a},setValue:function(b){a=b,this.notify(this.eventList.ENAME_MANIFEST_UPDATED,b),this.eventBus.dispatchEvent({type:"manifestLoaded",data:b})}}},MediaPlayer.models.ManifestModel.prototype={constructor:MediaPlayer.models.ManifestModel},MediaPlayer.dependencies.ManifestUpdater=function(){"use strict";var a=0/0,b=null,c=!1,d=!1,e=function(){null!==b&&(clearInterval(b),b=null)},f=function(){e.call(this),isNaN(a)||(this.debug.log("Refresh manifest in "+a+" seconds."),b=setTimeout(h.bind(this),Math.min(1e3*a,Math.pow(2,31)-1),this))},g=function(){var b,c,d=this,e=d.manifestModel.getValue();void 0!==e&&null!==e&&(b=d.manifestExt.getRefreshDelay(e),c=((new Date).getTime()-e.mpdLoadedTime.getTime())/1e3,a=Math.max(b-c,0),f.call(d))},h=function(){var a,b,c=this;d||(d=!0,a=c.manifestModel.getValue(),b=a.mpdUrl,a.hasOwnProperty("Location")&&(b=a.Location),c.manifestLoader.load(b))},i=function(a,b,d){d||(this.manifestModel.setValue(b),this.debug.log("Manifest has been refreshed."),c||g.call(this))},j=function(){this.start()},k=function(){this.stop()},l=function(){d=!1};return{debug:void 0,system:void 0,manifestModel:void 0,manifestExt:void 0,manifestLoader:void 0,setup:function(){g.call(this),this.streamsComposed=l,this.manifestLoaded=i,this.playbackStarted=j,this.playbackPaused=k},start:function(){c=!1,g.call(this)},stop:function(){c=!0,e.call(this)}}},MediaPlayer.dependencies.ManifestUpdater.prototype={constructor:MediaPlayer.dependencies.ManifestUpdater},MediaPlayer.dependencies.MediaSourceExtensions=function(){"use strict"},MediaPlayer.dependencies.MediaSourceExtensions.prototype={constructor:MediaPlayer.dependencies.MediaSourceExtensions,createMediaSource:function(){"use strict";var a="WebKitMediaSource"in window,b="MediaSource"in window;return b?new MediaSource:a?new WebKitMediaSource:null},attachMediaSource:function(a,b){"use strict";b.setSource(window.URL.createObjectURL(a))},detachMediaSource:function(a){"use strict";a.setSource("")},setDuration:function(a,b){"use strict";return a.duration=b,a.duration},signalEndOfStream:function(a){"use strict";"open"===a.readyState&&a.endOfStream()}},MediaPlayer.models.MetricsModel=function(){"use strict";return{system:void 0,eventBus:void 0,streamMetrics:{},metricsChanged:function(){this.eventBus.dispatchEvent({type:"metricsChanged",data:{}})},metricChanged:function(a){this.eventBus.dispatchEvent({type:"metricChanged",data:{stream:a}}),this.metricsChanged()},metricUpdated:function(a,b,c){this.eventBus.dispatchEvent({type:"metricUpdated",data:{stream:a,metric:b,value:c}}),this.metricChanged(a)},metricAdded:function(a,b,c){this.eventBus.dispatchEvent({type:"metricAdded",data:{stream:a,metric:b,value:c}}),this.metricChanged(a)},clearCurrentMetricsForType:function(a){delete this.streamMetrics[a],this.metricChanged(a)},clearAllCurrentMetrics:function(){var a=this;this.streamMetrics={},this.metricsChanged.call(a)},getReadOnlyMetricsFor:function(a){return this.streamMetrics.hasOwnProperty(a)?this.streamMetrics[a]:null},getMetricsFor:function(a){var b;return this.streamMetrics.hasOwnProperty(a)?b=this.streamMetrics[a]:(b=this.system.getObject("metrics"),this.streamMetrics[a]=b),b},addTcpConnection:function(a,b,c,d,e,f){var g=new MediaPlayer.vo.metrics.TCPConnection;return g.tcpid=b,g.dest=c,g.topen=d,g.tclose=e,g.tconnect=f,this.getMetricsFor(a).TcpList.push(g),this.metricAdded(a,"TcpConnection",g),g},addHttpRequest:function(a,b,c,d,e,f,g,h,i,j,k,l){var m=new MediaPlayer.vo.metrics.HTTPRequest;return m.stream=a,m.tcpid=b,m.type=c,m.url=d,m.actualurl=e,m.range=f,m.trequest=g,m.tresponse=h,m.tfinish=i,m.responsecode=j,m.interval=k,m.mediaduration=l,this.getMetricsFor(a).HttpList.push(m),this.metricAdded(a,"HttpRequest",m),m},appendHttpTrace:function(a,b,c,d){var e=new MediaPlayer.vo.metrics.HTTPRequest.Trace;return e.s=b,e.d=c,e.b=d,a.trace.push(e),this.metricUpdated(a.stream,"HttpRequestTrace",a),e},addRepresentationSwitch:function(a,b,c,d,e){var f=new MediaPlayer.vo.metrics.RepresentationSwitch;return f.t=b,f.mt=c,f.to=d,f.lto=e,this.getMetricsFor(a).RepSwitchList.push(f),this.metricAdded(a,"RepresentationSwitch",f),f},addBufferLevel:function(a,b,c){var d=new MediaPlayer.vo.metrics.BufferLevel;return d.t=b,d.level=c,this.getMetricsFor(a).BufferLevel.push(d),this.metricAdded(a,"BufferLevel",d),d},addDroppedFrames:function(a,b){var c=new MediaPlayer.vo.metrics.DroppedFrames,d=this.getMetricsFor(a).DroppedFrames;return c.time=b.creationTime,c.droppedFrames=b.droppedVideoFrames,d.length>0&&d[d.length-1]==c?d[d.length-1]:(d.push(c),this.metricAdded(a,"DroppedFrames",c),c)},addPlayList:function(a,b,c,d){var e=new MediaPlayer.vo.metrics.PlayList;return e.stream=a,e.start=b,e.mstart=c,e.starttype=d,this.getMetricsFor(a).PlayList.push(e),this.metricAdded(a,"PlayList",e),e},appendPlayListTrace:function(a,b,c,d,e,f,g,h){var i=new MediaPlayer.vo.metrics.PlayList.Trace;return i.representationid=b,i.subreplevel=c,i.start=d,i.mstart=e,i.duration=f,i.playbackspeed=g,i.stopreason=h,a.trace.push(i),this.metricUpdated(a.stream,"PlayListTrace",a),i}}},MediaPlayer.models.MetricsModel.prototype={constructor:MediaPlayer.models.MetricsModel},MediaPlayer.dependencies.Notifier=function(){"use strict";var a,b=0,c=function(){return this.id||(b+=1,this.id="_id_"+b),this.id},d=function(a){var b,c=this.eventList;for(b in c)if(c[b]===a)return!0;return!1};return{system:void 0,setup:function(){var b={ENAME_CLOSED_CAPTIONING_REQUESTED:"closedCaptioningRequested",ENAME_BUFFER_LEVEL_STATE_CHANGED:"bufferLevelStateChanged",ENAME_BUFFER_LEVEL_UPDATED:"bufferLevelUpdated",ENAME_QUOTA_EXCEEDED:"quotaExceeded",ENAME_BYTES_APPENDED:"bytesAppended",ENAME_BYTES_REJECTED:"bytesRejected",ENAME_BUFFERING_COMPLETED:"bufferingCompleted",ENAME_BUFFER_CLEARED:"bufferCleared",ENAME_INIT_REQUESTED:"initRequested",ENAME_BUFFER_LEVEL_OUTRUN:"bufferLevelOutrun",ENAME_BUFFER_LEVEL_BALANCED:"bufferLevelBalanced",ENAME_MIN_BUFFER_TIME_UPDATED:"minBufferTimeUpdated"},c={ENAME_SOURCEBUFFER_REMOVE_COMPLETED:"sourceBufferRemoveCompleted",ENAME_SOURCEBUFFER_APPEND_COMPLETED:"sourceBufferAppendCompleted"},d={ENAME_LOADING_COMPLETED:"loadingCompleted",ENAME_CHECK_FOR_EXISTENCE_COMPLETED:"checkForExistenceCompleted"},e={ENAME_REPRESENTATION_UPDATED:"representationUpdated"},f={ENAME_INITIALIZATION_LOADED:"initializationLoaded",ENAME_SEGMENTS_LOADED:"segmentsLoaded"},g={ENAME_QUALITY_CHANGED:"qualityChanged",ENAME_TOP_QUALITY_INDEX_CHANGED:"topQualityIndexChanged"},h={ENAME_SCHEDULED_TIME_OCCURED:"scheduledTimeOccurred"},i={ENAME_STREAM_UPDATED:"streamUpdated"},j={ENAME_DATA_UPDATE_COMPLETED:"dataUpdateCompleted",ENAME_DATA_UPDATE_STARTED:"dataUpdateStarted"},k={ENAME_STREAM_COMPLETED:"streamCompleted",ENAME_FRAGMENT_LOADING_STARTED:"fragmentLoadingStarted",ENAME_FRAGMENT_LOADING_COMPLETED:"fragmentLoadingCompleted",ENAME_FRAGMENT_LOADING_FAILED:"segmentLoadingFailed"},l={ENAME_STREAM_COMPLETED:"streamCompleted",ENAME_INIT_SEGMENT_LOADING_START:"initSegmentLoadingStart",ENAME_MEDIA_SEGMENT_LOADING_START:"mediaSegmentLoadingStart",ENAME_INIT_SEGMENT_LOADED:"initSegmentLoaded",ENAME_MEDIA_SEGMENT_LOADED:"mediaSegmentLoaded"},m={ENAME_STREAMS_COMPOSED:"streamsComposed"},n={ENAME_PLAYBACK_STARTED:"playbackStarted",ENAME_PLAYBACK_STOPPED:"playbackStopped",ENAME_PLAYBACK_PAUSED:"playbackPaused",ENAME_PLAYBACK_SEEKING:"playbackSeeking",ENAME_PLAYBACK_SEEKED:"playbackSeeked",ENAME_PLAYBACK_TIME_UPDATED:"playbackTimeUpdated",ENAME_PLAYBACK_PROGRESS:"playbackProgress",ENAME_PLAYBACK_RATE_CHANGED:"playbackRateChanged",ENAME_PLAYBACK_METADATA_LOADED:"playbackMetaDataLoaded",ENAME_PLAYBACK_ERROR:"playbackError",ENAME_WALLCLOCK_TIME_UPDATED:"wallclockTimeUpdated"},o={ENAME_LIVE_EDGE_FOUND:"liveEdgeFound"},p={ENAME_FRAGMENT_LOADING_COMPLETED:"fragmentLoadingCompleted"},q={ENAME_KEY_SYSTEM_UPDATE_COMPLETED:"keySystemUpdateCompleted"},r={ENAME_MANIFEST_UPDATED:"manifestUpdated"},s={ENAME_MANIFEST_LOADED:"manifestLoaded"};a=this.system,a.mapValue("notify",this.notify),a.mapValue("subscribe",this.subscribe),a.mapValue("unsubscribe",this.unsubscribe),a.mapValue("bufferControllerEvents",b),a.mapOutlet("bufferControllerEvents","bufferController","eventList"),a.mapOutlet("bufferControllerEvents","textController","eventList"),a.mapValue("sourceBufferEvents",c),a.mapOutlet("sourceBufferEvents","sourceBufferExt","eventList"),a.mapValue("manifestModelEvents",r),a.mapOutlet("manifestModelEvents","manifestModel","eventList"),a.mapValue("fragmentLoaderEvents",d),a.mapOutlet("fragmentLoaderEvents","fragmentLoader","eventList"),a.mapValue("baseUrlEvents",f),a.mapOutlet("baseUrlEvents","baseURLExt","eventList"),a.mapValue("liveEdgeFinderEvents",o),a.mapOutlet("liveEdgeFinderEvents","liveEdgeFinder","eventList"),a.mapValue("representationControllerEvents",j),a.mapOutlet("representationControllerEvents","representationController","eventList"),a.mapValue("requestSchedulerEvents",h),a.mapOutlet("requestSchedulerEvents","requestScheduler","eventList"),a.mapValue("fragmentModelEvents",k),a.mapOutlet("fragmentModelEvents","fragmentModel","eventList"),a.mapValue("fragmentControllerEvents",l),a.mapOutlet("fragmentControllerEvents","fragmentController","eventList"),a.mapValue("streamControllerEvents",m),a.mapOutlet("streamControllerEvents","streamController","eventList"),a.mapValue("playbackControllerEvents",n),a.mapOutlet("playbackControllerEvents","playbackController","eventList"),a.mapValue("abrControllerEvents",g),a.mapOutlet("abrControllerEvents","abrController","eventList"),a.mapValue("indexHandlerEvents",e),a.mapOutlet("indexHandlerEvents","indexHandler","eventList"),a.mapValue("fragmentExtensionsEvents",p),a.mapOutlet("fragmentExtensionsEvents","fragmentExtensions","eventList"),a.mapValue("protectionExtensionsEvents",q),a.mapOutlet("protectionExtensionsEvents","protectionExt","eventList"),a.mapValue("streamEvents",i),a.mapOutlet("streamEvents","stream","eventList"),a.mapValue("manifestLoaderEvents",s),a.mapOutlet("manifestLoaderEvents","manifestLoader","eventList")},notify:function(){var b=[].slice.call(arguments);b.splice(1,0,this),b[0]+=c.call(this),a.notify.apply(a,b)},subscribe:function(b,e,f,g){if(!f&&e[b]&&(f=e[b]=e[b].bind(e)),!d.call(this,b))throw"object does not support given event "+b;if(!e)throw"observer object cannot be null or undefined";if(!f)throw"event handler cannot be null or undefined";b+=c.call(this),a.mapHandler(b,void 0,f,g)},unsubscribe:function(b,d,e){e=e||d[b],b+=c.call(this),a.unmapHandler(b,void 0,e)}}},MediaPlayer.dependencies.Notifier.prototype={constructor:MediaPlayer.dependencies.Notifier},MediaPlayer.dependencies.PlaybackController=function(){"use strict";var a,b,c,d,e,f=1e3,g=function(){var b=this,c=function(){u.call(b)};null!==a&&h.call(this),a=setInterval(c,f)},h=function(){clearInterval(a),a=null},i=function(){if(!this.isPaused()){var a=this.getTime(),b=this.timelineConverter.calcActualPresentationTime(d,a,e),c=!isNaN(b)&&b!==a;c&&this.seek(b)}},j=function(a,c,f){d=f,b=d.adaptation.period,e=a.streamProcessor.isDynamic(),i.call(this)},k=function(){c&&(c.unlisten("play",l),c.unlisten("pause",m),c.unlisten("error",t),c.unlisten("seeking",n),c.unlisten("seeked",o),c.unlisten("timeupdate",p),c.unlisten("progress",q),c.unlisten("ratechange",r),c.unlisten("loadedmetadata",s))},l=function(){i.call(this),this.notify(this.eventList.ENAME_PLAYBACK_STARTED,this.getTime())},m=function(){this.notify(this.eventList.ENAME_PLAYBACK_PAUSED)},n=function(){this.notify(this.eventList.ENAME_PLAYBACK_SEEKING,this.getTime())},o=function(){c.listen("seeking",n),c.unlisten("seeked",o),this.notify(this.eventList.ENAME_PLAYBACK_SEEKED)},p=function(){this.notify(this.eventList.ENAME_PLAYBACK_TIME_UPDATED,this.getTimeToPeriodEnd())},q=function(){var a,d,e,f=c.getElement().buffered;f.length&&(a=f.length-1,d=f.end(a),e=this.timelineConverter.calcPresentationStartTime(b)+b.duration-d),this.notify(this.eventList.ENAME_PLAYBACK_PROGRESS,c.getElement().buffered,e)},r=function(){this.notify(this.eventList.ENAME_PLAYBACK_RATE_CHANGED)},s=function(){this.debug.log("Got loadmetadata event.");var a=this.timelineConverter.calcPresentationStartTime(b);this.debug.log("Starting playback at offset: "+a),this.seek(a),this.notify(this.eventList.ENAME_PLAYBACK_METADATA_LOADED)},t=function(a){this.notify(this.eventList.ENAME_PLAYBACK_ERROR,a.srcElement.error)},u=function(){this.notify(this.eventList.ENAME_WALLCLOCK_TIME_UPDATED,e,new Date)},v=function(a){c=a,c.listen("play",l),c.listen("pause",m),c.listen("error",t),c.listen("seeking",n),c.listen("seeked",o),c.listen("timeupdate",p),c.listen("progress",q),c.listen("ratechange",r),c.listen("loadedmetadata",s)};return{debug:void 0,timelineConverter:void 0,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this.dataUpdateCompleted=j,l=l.bind(this),m=m.bind(this),t=t.bind(this),n=n.bind(this),o=o.bind(this),p=p.bind(this),q=q.bind(this),r=r.bind(this),s=s.bind(this),g.call(this)},initialize:function(a,d){b=a,c!==d&&(k.call(this),v.call(this,d))},getTimeToPeriodEnd:function(){var a=c.getCurrentTime();return this.timelineConverter.calcPresentationStartTime(b)+b.duration-a},getPeriodDuration:function(){return b.duration},getTime:function(){return c.getCurrentTime()},getPlaybackRate:function(){return c.getPlaybackRate()},start:function(){c.play()},isPaused:function(){return c.isPaused()},pause:function(){c.pause()},seek:function(a){this.debug.log("Current time has changed, block programmatic seek."),a!==this.getTime()&&(c.unlisten("seeking",n),c.listen("seeked",o),c.setCurrentTime(a))},reset:function(){h.call(this),k.call(this),c=null,b=null}}},MediaPlayer.dependencies.PlaybackController.prototype={constructor:MediaPlayer.dependencies.PlaybackController},MediaPlayer.dependencies.ProtectionController=function(){"use strict";var a=null,b=null,c=function(a){var b=this;b.protectionModel.removeKeySystem(a)},d=function(a,c){for(var d=this,e=0;e<b.length;++e)for(var f=0;f<c.length;++f)if(b[e].isSupported(c[f])&&d.protectionExt.supportsCodec(b[e].keysTypeString,a)){var g=d.manifestExt.getKID(c[f]);return g||(g="unknown"),d.protectionModel.addKeySystem(g,c[f],b[e]),d.debug.log("DRM: Selected Key System: "+b[e].keysTypeString+" For KID: "+g),g}throw new Error("DRM: The protection system for this content is not supported.")},e=function(a,b,c){var d=this,e=null,f=null;d.protectionModel.needToAddKeySession(a)&&(f=d.protectionModel.getInitData(a),!f&&c?(f=c,d.debug.log("DRM: Using initdata from needskey event. length: "+f.length)):f&&d.debug.log("DRM: Using initdata from prheader in mpd. length: "+f.length),f?(e=d.protectionModel.addKeySession(a,b,f),d.debug.log("DRM: Added Key Session ["+e.sessionId+"] for KID: "+a+" type: "+b+" initData length: "+f.length)):d.debug.log("DRM: initdata is null."))},f=function(a,b,c,d){this.protectionModel.updateFromMessage(a,b,c,d)};return{system:void 0,debug:void 0,manifestExt:void 0,capabilities:void 0,protectionModel:void 0,protectionExt:void 0,setup:function(){b=this.protectionExt.getKeySystems()},init:function(b,c){this.videoModel=b,this.protectionModel=c,a=this.videoModel.getElement()},selectKeySystem:d,ensureKeySession:e,updateFromMessage:f,teardownKeySystem:c}},MediaPlayer.dependencies.ProtectionController.prototype={constructor:MediaPlayer.dependencies.ProtectionController},MediaPlayer.dependencies.ProtectionExtensions=function(){"use strict"},MediaPlayer.dependencies.ProtectionExtensions.prototype={constructor:MediaPlayer.dependencies.ProtectionExtensions,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,supportsCodec:function(a,b){"use strict";var c="WebKitMediaKeys"in window,d="MSMediaKeys"in window,e="MediaKeys"in window;return e?MediaKeys.isTypeSupported(a,b):c?WebKitMediaKeys.isTypeSupported(a,b):d?MSMediaKeys.isTypeSupported(a,b):!1},createMediaKeys:function(a){"use strict";var b="WebKitMediaKeys"in window,c="MSMediaKeys"in window,d="MediaKeys"in window;return d?new MediaKeys(a):b?new WebKitMediaKeys(a):c?new MSMediaKeys(a):null},setMediaKey:function(a,b){var c="WebKitSetMediaKeys"in a,d="msSetMediaKeys"in a,e="SetMediaKeys"in a;return e?a.SetMediaKeys(b):c?a.WebKitSetMediaKeys(b):d?a.msSetMediaKeys(b):void this.debug.log("no setmediakeys function in element")},createSession:function(a,b,c){return a.createSession(b,c)},getKeySystems:function(){var a=this,b=function(b,c){var d=null,e=[],f=new DOMParser,g=f.parseFromString(b,"application/xml");if(g.getElementsByTagName("Challenge")[0]){var h=g.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;h&&(d=BASE64.decode(h))}else a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error("DRM: playready update, can not find Challenge in keyMessage"));var i=g.getElementsByTagName("name"),j=g.getElementsByTagName("value");i.length!=j.length&&a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error("DRM: playready update, invalid header name/value pair in keyMessage"));for(var k=0;k<i.length;k++)e[k]={name:i[k].childNodes[0].nodeValue,value:j[k].childNodes[0].nodeValue};var l=new XMLHttpRequest;l.onload=function(){200==l.status?a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,new Uint8Array(l.response)):a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error('DRM: playready update, XHR status is "'+l.statusText+'" ('+l.status+"), expected to be 200. readyState is "+l.readyState))
},l.onabort=function(){a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error('DRM: playready update, XHR aborted. status is "'+l.statusText+'" ('+l.status+"), readyState is "+l.readyState))},l.onerror=function(){a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error('DRM: playready update, XHR error. status is "'+l.statusText+'" ('+l.status+"), readyState is "+l.readyState))},l.open("POST",c),l.responseType="arraybuffer",e&&e.forEach(function(a){l.setRequestHeader(a.name,a.value)}),l.send(d)},c=function(a,b){return null===a&&0===b.length},d=function(a){var b=0,c=0,d=0,e=new Uint8Array([112,115,115,104,0,0,0,0]),f=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),g=null,h=null,i=null,j=null;if("pro"in a)g=BASE64.decodeArray(a.pro.__text);else{if(!("prheader"in a))return null;g=BASE64.decodeArray(a.prheader.__text)}return c=g.length,d=4+e.length+f.length+4+c,h=new ArrayBuffer(d),i=new Uint8Array(h),j=new DataView(h),j.setUint32(b,d),b+=4,i.set(e,b),b+=e.length,i.set(f,b),b+=f.length,j.setUint32(b,c),b+=4,i.set(g,b),b+=c,i};return[{schemeIdUri:"urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",keysTypeString:"com.microsoft.playready",isSupported:function(a){return this.schemeIdUri===a.schemeIdUri.toLowerCase()},needToAddKeySession:c,getInitData:d,getUpdate:b},{schemeIdUri:"urn:mpeg:dash:mp4protection:2011",keysTypeString:"com.microsoft.playready",isSupported:function(a){return this.schemeIdUri===a.schemeIdUri.toLowerCase()&&"cenc"===a.value.toLowerCase()},needToAddKeySession:c,getInitData:function(){return null},getUpdate:b},{schemeIdUri:"urn:uuid:00000000-0000-0000-0000-000000000000",keysTypeString:"webkit-org.w3.clearkey",isSupported:function(a){return this.schemeIdUri===a.schemeIdUri.toLowerCase()},needToAddKeySession:function(){return!0},getInitData:function(){return null},getUpdate:function(a){return a}}]},addKey:function(a,b,c,d,e){a.webkitAddKey(b,c,d,e)},generateKeyRequest:function(a,b,c){a.webkitGenerateKeyRequest(b,c)},listenToNeedKey:function(a,b){a.listen("webkitneedkey",b),a.listen("msneedkey",b),a.listen("needKey",b)},listenToKeyError:function(a,b){a.addEventListener("webkitkeyerror",b,!1),a.addEventListener("mskeyerror",b,!1),a.addEventListener("keyerror",b,!1)},listenToKeyMessage:function(a,b){a.addEventListener("webkitkeymessage",b,!1),a.addEventListener("mskeymessage",b,!1),a.addEventListener("keymessage",b,!1)},listenToKeyAdded:function(a,b){a.addEventListener("webkitkeyadded",b,!1),a.addEventListener("mskeyadded",b,!1),a.addEventListener("keyadded",b,!1)},unlistenToKeyError:function(a,b){a.removeEventListener("webkitkeyerror",b),a.removeEventListener("mskeyerror",b),a.removeEventListener("keyerror",b)},unlistenToKeyMessage:function(a,b){a.removeEventListener("webkitkeymessage",b),a.removeEventListener("mskeymessage",b),a.removeEventListener("keymessage",b)},unlistenToKeyAdded:function(a,b){a.removeEventListener("webkitkeyadded",b),a.removeEventListener("mskeyadded",b),a.removeEventListener("keyadded",b)}},MediaPlayer.models.ProtectionModel=function(){"use strict";var a,b=null,c=null,d=null,e=null,f=[],g=function(b,c,d){d||a.update(c)};return{system:void 0,protectionExt:void 0,setup:function(){this.keySystemUpdateCompleted=g},init:function(a){this.videoModel=a,b=this.videoModel.getElement()},addKeySession:function(a,b,g){var h=null;return h=this.protectionExt.createSession(f[a].keys,b,g),this.protectionExt.listenToKeyAdded(h,c),this.protectionExt.listenToKeyError(h,d),this.protectionExt.listenToKeyMessage(h,e),f[a].initData=g,f[a].keySessions.push(h),h},addKeySystem:function(a,c,d){var e=null;e=this.protectionExt.createMediaKeys(d.keysTypeString),this.protectionExt.setMediaKey(b,e),f[a]={kID:a,contentProtection:c,keySystem:d,keys:e,initData:null,keySessions:[]}},removeKeySystem:function(a){if(null!==a&&void 0!==f[a]&&0!==f[a].keySessions.length){for(var b=f[a].keySessions,g=0;g<b.length;++g)this.protectionExt.unlistenToKeyError(b[g],d),this.protectionExt.unlistenToKeyAdded(b[g],c),this.protectionExt.unlistenToKeyMessage(b[g],e),b[g].close();f[a]=void 0}},needToAddKeySession:function(a){var b=null;return b=f[a],b.keySystem.needToAddKeySession(b.initData,b.keySessions)},getInitData:function(a){var b=null;return b=f[a],b.keySystem.getInitData(b.contentProtection)},updateFromMessage:function(b,c,d,e){a=c,f[b].keySystem.getUpdate(d,e)},listenToNeedKey:function(a){this.protectionExt.listenToNeedKey(this.videoModel,a)},listenToKeyError:function(a){d=a;for(var b=0;b<f.length;++b)for(var c=f[b].keySessions,e=0;e<c.length;++e)this.protectionExt.listenToKeyError(c[e],a)},listenToKeyMessage:function(a){e=a;for(var b=0;b<f.length;++b)for(var c=f[b].keySessions,d=0;d<c.length;++d)this.protectionExt.listenToKeyMessage(c[d],a)},listenToKeyAdded:function(a){c=a;for(var b=0;b<f.length;++b)for(var d=f[b].keySessions,e=0;e<d.length;++e)this.protectionExt.listenToKeyAdded(d[e],a)}}},MediaPlayer.models.ProtectionModel.prototype={constructor:MediaPlayer.models.ProtectionModel},MediaPlayer.dependencies.RequestScheduler=function(){"use strict";var a=[],b=1e3,c=null,d=!1,e=0,f=1,g=2,h=function(a,b,c){if(a&&b){var e;e=w.call(this,a,g),e.setScheduledTask(b),e.setIsScheduled(!0),e.setExecuteTime(c),d||i.call(this,a.playbackController)}},i=function(a){this.schedulerExt.attachScheduleListener(a,this),this.schedulerExt.attachUpdateScheduleListener(a,this),d=!0},j=function(){var a,b,c,d,e=x.call(this,g),f=e.length;for(d=0;f>d;d+=1)b=e[d],c=b.getExecuteTime(),a=b.getContext().playbackController.getTime(),b.getIsScheduled()&&a>c&&(b.executeScheduledTask(),b.setIsScheduled(!1))},k=function(a){var b,c=z(a,g);c&&(y(c),b=x.call(this,g),0===b.length&&l.call(this,a.playbackController))},l=function(a){this.schedulerExt.detachScheduleListener(a,this),this.schedulerExt.detachUpdateScheduleListener(a,this),d=!1},m=function(){n.call(this),j.call(this)},n=function(){var a,b=x.call(this,g),c=b.length;for(a=0;c>a;a+=1)b[a].setIsScheduled(!0)},o=function(a,b,c){if(a&&b){var d,e,g=c.getTime()-(new Date).getTime();e=w.call(this,a,f),e.setScheduledTask(b),d=setTimeout(function(){e.executeScheduledTask(),y(e)},g),e.setExecuteId(d)}},p=function(a){var b=z(a,f);b&&(clearTimeout(b.getExecuteId()),y(b))},q=function(a){if(a){var b=z(a,e);b||(b=w.call(this,a,e)),b.setIsScheduled(!0),t.call(this),this.notify(this.eventList.ENAME_SCHEDULED_TIME_OCCURED,b)}},r=function(){s.call(this)},s=function(){var a,b,c=this,d=x.call(c,e),f=d.length;for(b=0;f>b;b+=1)a=d[b],a.getIsScheduled()&&this.notify(this.eventList.ENAME_SCHEDULED_TIME_OCCURED,a)},t=function(){null===c&&(c=setInterval(r.bind(this),b))},u=function(a){var b=z(a,e),c=x.call(this,e);b&&(y(b),0===c.length&&v.call(this))},v=function(){clearInterval(c),c=null},w=function(b,c){if(!b)return null;var d=this.system.getObject("schedulerModel");return d.setContext(b),d.setType(c),a.push(d),d},x=function(b){var c,d,e=[];for(d=0;d<a.length;d+=1)c=a[d],c.getType()===b&&e.push(c);return e},y=function(b){var c=a.indexOf(b);-1!==c&&a.splice(c,1)},z=function(b,c){for(var d=0;d<a.length;d++)if(a[d].getContext()===b&&a[d].getType()===c)return a[d];return null},A=function(d){var e=this.schedulerExt.getExecuteInterval(d);if(b!==e){if(b=e,a.length<1)return;null!==c&&(this.debug.log("Changing execute interval: "+b),clearInterval(c),c=setInterval(r.bind(this),b))}},B=function(a,b){A.call(this,b)};return{system:void 0,debug:void 0,schedulerExt:void 0,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this.minBufferTimeUpdated=B,this.playbackSeeking=j,this.playbackTimeUpdated=m},isScheduled:function(a){var b=z(a,e);return!!b&&b.getIsScheduled()},getExecuteInterval:function(){return b},startScheduling:q,stopScheduling:u,setTriggerForVideoTime:h,setTriggerForWallTime:o,removeTriggerForVideoTime:k,removeTriggerForWallTime:p}},MediaPlayer.dependencies.RequestScheduler.prototype={constructor:MediaPlayer.dependencies.RequestScheduler},MediaPlayer.dependencies.ScheduleController=function(){"use strict";var a,b,c,d,e,f,g,h,i,j="WAITING",k="READY",l="VALIDATING",m="LOADING",n=j,o=!0,p=0,q=!1,r=null,s=null,t=!0,u=function(a){var b=this;n=a,null!==e&&b.fragmentController.onStateChange()},v=function(a,b){var c=0,d=null;t===!1&&(d=s.start,c=a.getTime()-d.getTime(),s.duration=c,s.stopreason=b,t=!0)},w=function(){c&&d&&(u.call(this,k),this.requestScheduler.startScheduling(this))},x=function(){var a;this.requestScheduler.isScheduled(this)||(f===!1&&(a=new Date,v(a,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON),r=this.metricsModel.addPlayList(b,a,0,MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON)),this.debug.log("ScheduleController "+b+" start."),d=!0,q=!0,w.call(this))},y=function(a){F.call(this,p),this.seek(a)},z=function(a){var c;this.debug.log("ScheduleController "+b+" seek: "+a),f=!0,g=a,c=new Date,v(c,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON),r=this.metricsModel.addPlayList(b,c,g,MediaPlayer.vo.metrics.PlayList.SEEK_START_REASON),x.call(this)},A=function(){n!==j&&(this.debug.log("ScheduleController "+b+" stop."),u.call(this,j),this.requestScheduler.stopScheduling(this),this.fragmentController.cancelPendingRequestsForModel(e),d=!1,q=!1,v(new Date,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON))},B=function(){o&&(this.debug.log("Marking a special seek for initial "+b+" playback."),f||(f=!0,g=0),o=!1)},C=function(){var a,b,c,d=this;return b=f?g:d.indexHandler.getCurrentTime(i),f=!1,a=d.sourceBufferExt.getBufferRange(d.bufferController.getBuffer(),b),null!==a&&(b=a.end),c=d.indexHandler.getSegmentRequestForTime(i,b)},D=function(a){var b,c=this;null!==a?c.fragmentController.isFragmentLoadedOrPending(c,a)?"complete"!==a.action?(b=c.indexHandler.getNextSegmentRequest(i),D.call(c,b)):(A.call(c),u.call(c,k)):(c.fragmentController.prepareFragmentForLoading(c,a),u.call(c,k)):u.call(c,k)},E=function(){var b,c=this,d=c.fragmentController.getPendingRequests(c),e=c.fragmentController.getLoadingRequests(c),f=(d?d.length:0)+(e?e.length:0);a-f>0?(a--,b=C.call(c),D.call(c,b)):(n===l&&u.call(c,k),I.call(c))},F=function(a){var b,c=this;b=c.indexHandler.getInitRequest(c.representationController.getRepresentationForQuality(a)),null!==b&&(c.fragmentController.prepareFragmentForLoading(c,b),u.call(c,k))},G=function(){var a,b,c=this,d=c.playbackController.getPlaybackRate(),e=c.playbackController.getPeriodDuration(),f=c.bufferController.getBufferLevel()/Math.max(d,1);return b=c.bufferExt.getRequiredBufferLength(q,c.requestScheduler.getExecuteInterval(c)/1e3,h,e),a=c.indexHandler.getSegmentCountForDuration(i,b,f)},H=function(){var b=this;return J.call(b)||o?void(n===k?(u.call(b,l),a=G.call(b),B.call(this),E.call(this)):n===l&&u.call(b,k)):void A.call(b)},I=function(){var a=this;n===m&&u.call(a,k)},J=function(){var a=this.playbackController.isPaused();return!a||a&&this.scheduleWhilePaused},K=function(){var a=this;null!==b&&""!==b&&a.metricsModel.clearCurrentMetricsForType(b)},L=function(a,b,d){var e,f=this;e=f.indexHandler.getCurrentTime(i||d),i=d,h||(c=!0),c&&y.call(f,e)},M=function(a,c){c===this.streamProcessor.getFragmentModel()&&(this.debug.log(b+" Stream is complete."),v(new Date,MediaPlayer.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON),A.call(this))},N=function(a,b){var c=this;b===c.streamProcessor.getFragmentModel()&&u.call(this,k)},O=function(a,b){var c,d=this;b===d.streamProcessor.getFragmentModel()&&(c=d.fragmentController.getLoadingTime(d),u.call(this,m),setTimeout(function(){d.fragmentController&&(u.call(d,k),E.call(d))},c))},P=function(){A.call(this)},Q=function(){var a=this,b=a.playbackController.getTime(),c=new Date;t===!0&&n!==j&&-1!==p&&(t=!1,s=a.metricsModel.appendPlayListTrace(r,i.id,null,c,b,null,1,null)),!this.requestScheduler.isScheduled(this)&&J.call(this)&&x.call(this)},R=function(a,b,c){var d=e.getExecutedRequestForQualityAndIndex(b,c);e.removeExecutedRequest(d)},S=function(){A.call(this)},T=function(a,b){F.call(this,b)},U=function(){u.call(this,k)},V=function(){a=0},W=function(a,b,c){this.fragmentController.removeExecutedRequestsBeforeTime(e,c)},X=function(a,c){var d=this;c?q=!1:(q=!0,d.debug.log("Stalling "+b+" Buffer: "+b),v(new Date,MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON))},Y=function(a,c){var d=this;d.metricsModel.addBufferLevel(b,new Date,c)},Z=function(a,c,d,e){if(b===c){var f=this,g=new Date,h=f.playbackController.getTime();if(p!==e){if(p=e,i=f.representationController.getRepresentationForQuality(e),null===i||void 0===i)throw"Unexpected error!";v(new Date,MediaPlayer.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON),f.metricsModel.addRepresentationSwitch(b,g,h,i.id)}}},$=function(a,c){b===c.getContext().streamProcessor.getType()&&H.call(this)},_=function(a,b){var c=this;F.call(c,b),e.executeCurrentRequest()},ab=function(a,b){z.call(this,b)},bb=function(){(!this.scheduleWhilePaused||h)&&A.call(this)},cb=function(a,b){z.call(this,b)},db=function(a,b,d){var e,f,g=this,h=i.segmentDuration||0,j=Math.max(b-g.bufferController.getMinBufferTime(),i.segmentAvailabilityRange.start);e=g.indexHandler.getSegmentRequestForTime(i,j),f=e.startTime,d.liveEdge=f+h/2,c=!0,y.call(g,f)};return{debug:void 0,system:void 0,metricsModel:void 0,bufferExt:void 0,scheduleWhilePaused:void 0,sourceBufferExt:void 0,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this.liveEdgeFound=db,this.scheduledTimeOccurred=$,this.qualityChanged=Z,this.dataUpdateStarted=S,this.dataUpdateCompleted=L,this.initSegmentLoadingStart=N,this.mediaSegmentLoadingStart=O,this.segmentLoadingFailed=P,this.streamCompleted=M,this.bufferCleared=W,this.bufferingCompleted=U,this.bytesAppended=Q,this.bytesRejected=R,this.bufferLevelOutrun=V,this.bufferLevelStateChanged=X,this.bufferLevelUpdated=Y,this.initRequested=T,this.closedCaptioningRequested=_,this.playbackStarted=ab,this.playbackPaused=bb,this.playbackSeeking=cb},initialize:function(a,c){var d=this;b=a,d.streamProcessor=c,d.playbackController=c.playbackController,d.fragmentController=c.fragmentController,d.representationController=c.representationController,d.liveEdgeFinder=c.liveEdgeFinder,d.bufferController=c.bufferController,d.indexHandler=c.indexHandler,d.requestScheduler=c.requestScheduler,h=c.isDynamic(),e=this.fragmentController.getModel(this)},getFragmentModel:function(){return e},reset:function(){var a=this;A.call(a),a.fragmentController.abortRequestsForModel(e),a.fragmentController.detachModel(e),K.call(a)},isReady:function(){return n===k},start:x,seek:z,stop:A}},MediaPlayer.dependencies.ScheduleController.prototype={constructor:MediaPlayer.dependencies.ScheduleController},MediaPlayer.dependencies.SchedulerExtensions=function(){"use strict"},MediaPlayer.dependencies.SchedulerExtensions.prototype={constructor:MediaPlayer.dependencies.SchedulerExtensions,getExecuteInterval:function(a){var b=1e3*a/4;return b=Math.max(b,1e3)},attachScheduleListener:function(a,b){a.subscribe(a.eventList.ENAME_PLAYBACK_TIME_UPDATED,b)},detachScheduleListener:function(a,b){a.unsubscribe(a.eventList.ENAME_PLAYBACK_TIME_UPDATED,b)},attachUpdateScheduleListener:function(a,b){a.subscribe(a.eventList.ENAME_PLAYBACK_SEEKING,b)},detachUpdateScheduleListener:function(a,b){a.unsubscribe(a.eventList.ENAME_PLAYBACK_SEEKING,b)}},MediaPlayer.dependencies.SchedulerModel=function(){"use strict";var a,b,c,d,e,f=!1;return{system:void 0,debug:void 0,setContext:function(b){a=b},getContext:function(){return a},setScheduledTask:function(a){b=a},executeScheduledTask:function(){b.call(a)},setExecuteTime:function(a){d=a},getExecuteTime:function(){return d},setExecuteId:function(a){e=a},getExecuteId:function(){return e},setType:function(a){c=a},getType:function(){return c},setIsScheduled:function(a){f=a},getIsScheduled:function(){return f}}},MediaPlayer.dependencies.SchedulerModel.prototype={constructor:MediaPlayer.dependencies.SchedulerModel},MediaPlayer.dependencies.SourceBufferExtensions=function(){"use strict";this.system=void 0,this.manifestExt=void 0,this.errHandler=void 0,this.eventList=void 0,this.notify=void 0,this.subscribe=void 0,this.unsubscribe=void 0},MediaPlayer.dependencies.SourceBufferExtensions.prototype={constructor:MediaPlayer.dependencies.SourceBufferExtensions,createSourceBuffer:function(a,b){"use strict";var c=this,d=null;try{d=a.addSourceBuffer(b)}catch(e){if(!c.manifestExt.getIsTextTrack(b))throw e;d=c.system.getObject("textSourceBuffer")}return d},removeSourceBuffer:function(a,b){"use strict";try{a.removeSourceBuffer(b)}catch(c){}},getBufferRange:function(a,b,c){"use strict";var d,e,f=null,g=0,h=0,i=null,j=null,k=0,l=c||.15;try{f=a.buffered}catch(m){return null}if(null!==f){for(e=0,d=f.length;d>e;e+=1)if(g=f.start(e),h=f.end(e),null===i)k=Math.abs(g-b),b>=g&&h>b?(i=g,j=h):l>=k&&(i=g,j=h);else{if(k=g-j,!(l>=k))break;j=h}if(null!==i)return{start:i,end:j}}return null},getAllRanges:function(a){var b=null;try{return b=a.buffered}catch(c){return null}},getBufferLength:function(a,b,c){"use strict";var d,e,f=this;return d=f.getBufferRange(a,b,c),e=null===d?0:d.end-b},waitForUpdateEnd:function(a,b){"use strict";var c,d=50,e=function(){a.updating||(clearInterval(c),b(!0))},f=function(){a.removeEventListener("updateend",f,!1),b(!0)};if(a.hasOwnProperty("addEventListener"))try{a.addEventListener("updateend",f,!1)}catch(g){c=setInterval(e,d)}else c=setInterval(e,d)},append:function(a,b){var c=this;try{"append"in a?a.append(b):"appendBuffer"in a&&a.appendBuffer(b),this.waitForUpdateEnd(a,function(){c.notify(c.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,b)})}catch(d){c.notify(c.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,b,d)}},remove:function(a,b,c,d){var e=this;try{b>=0&&c>b&&"ended"!==d.readyState&&a.remove(b,c),this.waitForUpdateEnd(a,function(){e.notify(e.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,b,c)})}catch(f){e.notify(e.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,b,c,f)}},abort:function(a,b){"use strict";try{"open"===a.readyState&&b.abort()}catch(c){}}},MediaPlayer.dependencies.Stream=function(){"use strict";var a,b,c,d,e,f,g={},h=null,i=[],j=!0,k=!1,l=!1,m=!1,n=null,o=[],p=!0,q=null,r=function(){k&&this.playbackController.start()},s=function(){this.playbackController.pause()},t=function(a){k&&(this.debug.log("Do seek: "+a),this.playbackController.seek(a),G(a))},u=function(a){var b,c=this,d=g.video;if(b="msneedkey"!==a.type?a.type:d,o.push({type:b,initData:a.initData}),this.debug.log("DRM: Key required for - "+b),h&&d&&!n)try{n=c.protectionController.selectKeySystem(d,h)}catch(e){s.call(c),c.debug.log(e),c.errHandler.mediaKeySystemSelectionError(e)}n&&c.protectionController.ensureKeySession(n,b,a.initData)},v=function(a){var b=this,c=null,d=null,e=null,f=null;this.debug.log("DRM: Got a key message..."),c=a.target,d=new Uint16Array(a.message.buffer),e=String.fromCharCode.apply(null,d),f=a.destinationURL,b.protectionController.updateFromMessage(n,c,e,f)},w=function(){this.debug.log("DRM: Key added.")},x=function(){var a,b=event.target;switch(a="DRM: MediaKeyError - sessionId: "+b.sessionId+" errorCode: "+b.error.code+" systemErrorCode: "+b.error.systemCode+" [",b.error.code){case 1:a+="MEDIA_KEYERR_UNKNOWN - An unspecified error occurred. This value is used for errors that don't match any of the other codes.";break;case 2:a+="MEDIA_KEYERR_CLIENT - The Key System could not be installed or updated.";break;case 3:a+="MEDIA_KEYERR_SERVICE - The message passed into update indicated an error from the license service.";break;case 4:a+="MEDIA_KEYERR_OUTPUT - There is no available output device with the required characteristics for the content protection system.";break;case 5:a+="MEDIA_KEYERR_HARDWARECHANGE - A hardware configuration change caused a content protection error.";break;case 6:a+="MEDIA_KEYERR_DOMAIN - An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain."}a+="]",this.debug.log(a),this.errHandler.mediaKeySessionError(a)},y=function(a,b){var c=this,d=function(e){c.debug.log("MediaSource is open!"),c.debug.log(e),a.removeEventListener("sourceopen",d),a.removeEventListener("webkitsourceopen",d),b(a)};a.addEventListener("sourceopen",d,!1),a.addEventListener("webkitsourceopen",d,!1),c.mediaSourceExt.attachMediaSource(a,c.videoModel)},z=function(){var c,d=this,e=i.length,f=0;for(f;e>f;f+=1)c=i[f],c.reset(m),c=null;i=[],b&&d.mediaSourceExt.detachMediaSource(d.videoModel),k=!1,n=null,o=[],h=null,g={},b=null,a=null},A=function(a,c,d){var e,f,j,k,l=this,m=function(a){return l.manifestExt.getCodec(a)};if("text"===a&&(m=function(a){return e=l.manifestExt.getMimeType(a)}),k=l.manifestExt.getDataForType(c,d,a),null!==k){var n,o=m.call(l,k),p=null;if(o===e)try{p=l.sourceBufferExt.createSourceBuffer(b,e)}catch(r){l.errHandler.mediaSourceError("Error creating "+a+" source buffer.")}else if(f=o,l.debug.log(a+" codec: "+f),g[a]=f,n=l.manifestExt.getContentProtectionData(k),n&&!l.capabilities.supportsMediaKeys())l.errHandler.capabilityError("mediakeys");else if(h=n,l.capabilities.supportsCodec(l.videoModel.getElement(),f))try{p=l.sourceBufferExt.createSourceBuffer(b,f)}catch(r){l.errHandler.mediaSourceError("Error creating "+a+" source buffer.")}else{var s=a+"Codec ("+f+") is not supported.";l.errHandler.manifestError(s,"codec",c),l.debug.log(s)}null===p?l.debug.log("No buffer was created, skipping "+a+" data."):(j=l.system.getObject("streamProcessor"),j.initialize(e||a,p,l.videoModel,l.requestScheduler,l.fragmentController,l.playbackController,b,k,q,l),i.push(j))}else l.debug.log("No "+a+" data.")},B=function(){var b=this;if(this.requestScheduler.subscribe(this.requestScheduler.eventList.ENAME_SCHEDULED_TIME_OCCURED,this.abrController),A.call(b,"video",a,q.index),A.call(b,"audio",a,q.index),A.call(b,"text",a,q.index),0===i.length){var c="No streams to play.";this.errHandler.manifestError(c,"nostreams",a),this.debug.log(c)}},C=function(){var a,c,d=this;a=d.manifestExt.getDuration(d.manifestModel.getValue(),q),c=d.mediaSourceExt.setDuration(b,a),d.debug.log("Duration successfully set to: "+c),k=!0},D=function(){this.debug.log("element loaded!"),l=!0,E.call(this)},E=function(){k&&l&&0===q.index&&j&&r.call(this)},F=function(a,b){var c=b.code,d="";if(-1!==c){switch(c){case 1:d="MEDIA_ERR_ABORTED";break;case 2:d="MEDIA_ERR_NETWORK";break;case 3:d="MEDIA_ERR_DECODE";break;case 4:d="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:d="MEDIA_ERR_ENCRYPTED"}m=!0,this.debug.log("Video Element Error: "+d),this.debug.log(b),this.errHandler.mediaSourceError(d),this.reset()}},G=function(a){var b,c=L(),d=c.length,e=0;for(e;d>e;e+=1)b=c[e],void 0===a?b.start():b.seek(a)},H=function(c){var d,e=this,f=function(a){b=a,B.call(e),C.call(e),E.call(e)};a=c,d=e.mediaSourceExt.createMediaSource(),y.call(e,d,f)},I=function(){var a=L(),c=a.length,d=0;for(d;c>d;d+=1)if(!a[d].isBufferingCompleted())return;b&&this.mediaSourceExt.signalEndOfStream(b)},J=function(){var a=this,b=i.length,c=0;if(k){for(c;b>c;c+=1)if(i[c].isUpdating())return;p=!1,a.notify(a.eventList.ENAME_STREAM_UPDATED)}},K=function(a,b,c){c&&(s.call(this),this.debug.log(c),this.errHandler.mediaKeyMessageError(c))},L=function(){var a,b,c=[],d=0,e=i.length;for(d;e>d;d+=1)b=i[d],a=b.getType(),("audio"===a||"video"===a)&&c.push(b);return c},M=function(b){var c,d,e,f,g=this,h=i.length,j=0;for(p=!0,a=g.manifestModel.getValue(),q=b,g.debug.log("Manifest updated... set new data on buffers."),j;h>j;j+=1)f=i[j],d=f.getData(),c=f.getDataIndex(),e=d&&d.hasOwnProperty("id")?g.manifestExt.getDataForId(d.id,a,q.index):g.manifestExt.getDataForIndex(c,a,q.index),f.updateData(e,q)};return{system:void 0,manifestModel:void 0,mediaSourceExt:void 0,sourceBufferExt:void 0,manifestExt:void 0,fragmentController:void 0,playbackController:void 0,protectionModel:void 0,protectionController:void 0,protectionExt:void 0,capabilities:void 0,debug:void 0,errHandler:void 0,timelineConverter:void 0,requestScheduler:void 0,abrController:void 0,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this.bufferingCompleted=I,this.dataUpdateCompleted=J,this.playbackError=F,this.playbackMetaDataLoaded=D,this.keySystemUpdateCompleted=K},load:function(a){H.call(this,a)},setVideoModel:function(a){this.videoModel=a},initProtection:function(){c=u.bind(this),d=v.bind(this),e=w.bind(this),f=x.bind(this),this.protectionModel=this.system.getObject("protectionModel"),this.protectionModel.init(this.getVideoModel()),this.protectionController=this.system.getObject("protectionController"),this.protectionController.init(this.videoModel,this.protectionModel),this.protectionModel.listenToNeedKey(c),this.protectionModel.listenToKeyMessage(d),this.protectionModel.listenToKeyError(f),this.protectionModel.listenToKeyAdded(e),this.protectionExt.subscribe(this.protectionExt.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,this.protectionModel),this.protectionExt.subscribe(this.protectionExt.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,this)},getVideoModel:function(){return this.videoModel},getManifestExt:function(){var a=this;return a.manifestExt},setAutoPlay:function(a){j=a},getAutoPlay:function(){return j},reset:function(){s.call(this),z.call(this),this.protectionController&&this.protectionController.teardownKeySystem(n),this.requestScheduler.unsubscribe(this.requestScheduler.eventList.ENAME_SCHEDULED_TIME_OCCURED,this.abrController),this.protectionController=void 0,this.protectionModel=void 0,this.fragmentController=void 0,this.requestScheduler=void 0,this.playbackController.reset(),this.playbackController=void 0,l=!1},getDuration:function(){return q.duration},getStartTime:function(){return q.start},getPeriodIndex:function(){return q.index},getId:function(){return q.id},setPeriodInfo:function(a){q=a},getPeriodInfo:function(){return q},setPlaybackController:function(a){this.playbackController=a,a.initialize(q,this.videoModel)},getPlaybackController:function(){return this.playbackController},isUpdating:function(){return p},updateData:M,play:r,seek:t,pause:s}},MediaPlayer.dependencies.Stream.prototype={constructor:MediaPlayer.dependencies.Stream},MediaPlayer.dependencies.StreamController=function(){"use strict";var a,b=[],c=4,d=3,e=!0,f=!1,g=function(){a.play()},h=function(){a.pause()},i=function(b){a.seek(b)},j=function(a,b){var c=a.getVideoModel().getElement(),d=b.getVideoModel().getElement();d.parentNode||c.parentNode.insertBefore(d,c),c.style.width="0px",d.style.width="100%",m(c,d),l.call(this,a),k.call(this,b)},k=function(a){var b=a.getPlaybackController();b.subscribe(b.eventList.ENAME_PLAYBACK_STARTED,this.manifestUpdater),b.subscribe(b.eventList.ENAME_PLAYBACK_PAUSED,this.manifestUpdater),b.subscribe(b.eventList.ENAME_PLAYBACK_SEEKING,this),b.subscribe(b.eventList.ENAME_PLAYBACK_TIME_UPDATED,this),b.subscribe(b.eventList.ENAME_PLAYBACK_PROGRESS,this)},l=function(a){var b=a.getPlaybackController();b.unsubscribe(b.eventList.ENAME_PLAYBACK_STARTED,this.manifestUpdater),b.unsubscribe(b.eventList.ENAME_PLAYBACK_PAUSED,this.manifestUpdater),b.unsubscribe(b.eventList.ENAME_PLAYBACK_SEEKING,this),b.unsubscribe(b.eventList.ENAME_PLAYBACK_TIME_UPDATED,this),b.unsubscribe(b.eventList.ENAME_PLAYBACK_PROGRESS,this)},m=function(a,b){["controls","loop","muted","playbackRate","volume"].forEach(function(c){b[c]=a[c]})},n=function(a,b,d){!d||d>=c||s()},o=function(b,c){var e=this;e.metricsModel.addDroppedFrames("video",e.videoExt.getPlaybackQuality(a.getVideoModel().getElement())),t()&&(a.getVideoModel().getElement().seeking||d>c&&x.call(this,a,t()))},p=function(b,c){var d=u(c);d&&d!==a&&x.call(this,a,d,c)},q=function(){this.manifestUpdater.stop()},r=function(){this.manifestUpdater.start()},s=function(){var a=t();a&&a.seek(a.getStartTime())},t=function(){var c=a.getPeriodIndex()+1;return c<b.length?b[c]:null},u=function(a){var c=0,d=null,e=b.length;e>0&&(c+=b[0].getStartTime());for(var f=0;e>f;f++)if(d=b[f],c+=d.getDuration(),c>a)return d},v=function(){var a=this.system.getObject("videoModel"),b=document.createElement("video");return a.setElement(b),a},w=function(a){a.parentNode&&a.parentNode.removeChild(a)},x=function(b,c,d){!f&&b&&c&&b!==c&&(f=!0,b.pause(),a=c,j.call(this,b,c),i(d?b.getPlaybackController().getTime():c.getStartTime()),g(),f=!1)},y=function(){var c,d,f,g,h,i,j,l,m,n=this,o=n.manifestModel.getValue();if(o){l=n.manifestExt.getMpd(o),j=n.manifestExt.getRegularPeriods(o,l);try{if(0===j.length)throw new Error("There are no regular periods");for(g=0,d=j.length;d>g;g+=1){for(i=j[g],h=0,f=b.length;f>h;h+=1)b[h].getId()===i.id&&(m=b[h],m.updateData(i));m||(m=n.system.getObject("stream"),c=n.system.getObject("playbackController"),m.setPeriodInfo(i),m.setVideoModel(0===g?n.videoModel:v.call(n)),m.setPlaybackController(c),c.subscribe(c.eventList.ENAME_PLAYBACK_ERROR,m),c.subscribe(c.eventList.ENAME_PLAYBACK_METADATA_LOADED,m),m.initProtection(),m.setAutoPlay(e),m.load(o),m.subscribe(m.eventList.ENAME_STREAM_UPDATED,n),b.push(m)),m=null}a||(a=b[0],k.call(n,a))}catch(p){n.errHandler.manifestError(p.message,"nostreamscomposed",n.manifestModel.getValue()),n.reset()}}},z=function(){var a=this,c=b.length,d=0;for(d;c>d;d+=1)if(b[d].isUpdating())return;a.notify(a.eventList.ENAME_STREAMS_COMPOSED)},A=function(a,b,c){c?this.reset():(this.manifestModel.setValue(b),this.debug.log("Manifest has loaded."),y.call(this))};return{system:void 0,videoModel:void 0,manifestLoader:void 0,manifestUpdater:void 0,manifestModel:void 0,manifestExt:void 0,debug:void 0,metricsModel:void 0,videoExt:void 0,errHandler:void 0,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this.manifestLoaded=A,this.streamUpdated=z,this.playbackStarted=r,this.playbackPaused=q,this.playbackSeeking=p,this.playbackProgress=n,this.playbackTimeUpdated=o},getManifestExt:function(){return a.getManifestExt()},setAutoPlay:function(a){e=a},getAutoPlay:function(){return e},getVideoModel:function(){return this.videoModel},setVideoModel:function(a){this.videoModel=a},load:function(a){this.manifestLoader.load(a)},reset:function(){a&&l.call(this,a);for(var c=0,d=b.length;d>c;c++){var e=b[c];e.unsubscribe(e.eventList.ENAME_STREAM_UPDATED,this),e.reset(),e!==a&&w(e.getVideoModel().getElement())}b=[],this.manifestUpdater.stop(),this.manifestModel.setValue(null),f=!1,a=null},play:g,seek:i,pause:h}},MediaPlayer.dependencies.StreamController.prototype={constructor:MediaPlayer.dependencies.StreamController},MediaPlayer.dependencies.StreamProcessor=function(){"use strict";var a,b,c,d=function(a){var b=this,c="video"===a||"audio"===a?"bufferController":"textController";return b.system.getObject(c)};return{system:void 0,manifestModel:void 0,manifestExt:void 0,indexHandler:void 0,liveEdgeFinder:void 0,eventList:void 0,timelineConverter:void 0,abrController:void 0,baseURLExt:void 0,initialize:function(e,f,g,h,i,j,k,l,m,n){var o,p=this,q=p.manifestModel.getValue(),r=p.system.getObject("representationController"),s=p.system.getObject("scheduleController"),t=p.liveEdgeFinder,u=p.abrController,v=p.indexHandler,w=p.baseURLExt,x=this.system.getObject("fragmentLoader"),y=d.call(p,e);b=n,c=e,a=p.manifestExt.getIsDynamic(q),v.setType(c),v.setIsDynamic(a),p.bufferController=y,p.playbackController=j,p.scheduleController=s,p.representationController=r,p.videoModel=g,p.fragmentController=i,p.requestScheduler=h,p.fragmentLoader=x,p.liveEdgeFinder.initialize(this),u.subscribe(u.eventList.ENAME_QUALITY_CHANGED,y),u.subscribe(u.eventList.ENAME_QUALITY_CHANGED,r),u.subscribe(u.eventList.ENAME_QUALITY_CHANGED,s),h.subscribe(h.eventList.ENAME_SCHEDULED_TIME_OCCURED,y),h.subscribe(h.eventList.ENAME_SCHEDULED_TIME_OCCURED,s),t.subscribe(t.eventList.ENAME_LIVE_EDGE_FOUND,p.timelineConverter),t.subscribe(t.eventList.ENAME_LIVE_EDGE_FOUND,s),r.subscribe(r.eventList.ENAME_DATA_UPDATE_STARTED,s),r.subscribe(r.eventList.ENAME_DATA_UPDATE_COMPLETED,y),r.subscribe(r.eventList.ENAME_DATA_UPDATE_COMPLETED,s),r.subscribe(r.eventList.ENAME_DATA_UPDATE_COMPLETED,u),r.subscribe(r.eventList.ENAME_DATA_UPDATE_COMPLETED,b),r.subscribe(r.eventList.ENAME_DATA_UPDATE_COMPLETED,t),r.subscribe(r.eventList.ENAME_DATA_UPDATE_COMPLETED,j),i.subscribe(i.eventList.ENAME_INIT_SEGMENT_LOADED,y),i.subscribe(i.eventList.ENAME_MEDIA_SEGMENT_LOADED,y),i.subscribe(i.eventList.ENAME_INIT_SEGMENT_LOADING_START,s),i.subscribe(i.eventList.ENAME_MEDIA_SEGMENT_LOADING_START,s),i.subscribe(i.eventList.ENAME_STREAM_COMPLETED,s),i.subscribe(i.eventList.ENAME_STREAM_COMPLETED,y),y.subscribe(y.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,g),y.subscribe(y.eventList.ENAME_MIN_BUFFER_TIME_UPDATED,h),y.subscribe(y.eventList.ENAME_BUFFER_CLEARED,s),y.subscribe(y.eventList.ENAME_BUFFERING_COMPLETED,s),y.subscribe(y.eventList.ENAME_BYTES_APPENDED,s),y.subscribe(y.eventList.ENAME_BYTES_REJECTED,s),y.subscribe(y.eventList.ENAME_BUFFER_LEVEL_OUTRUN,s),y.subscribe(y.eventList.ENAME_BUFFER_LEVEL_UPDATED,s),y.subscribe(y.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,s),y.subscribe(y.eventList.ENAME_INIT_REQUESTED,s),y.subscribe(y.eventList.ENAME_BUFFER_LEVEL_BALANCED,i),y.subscribe(y.eventList.ENAME_BUFFERING_COMPLETED,b),y.subscribe(y.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,s),j.subscribe(j.eventList.ENAME_PLAYBACK_PROGRESS,y),j.subscribe(j.eventList.ENAME_PLAYBACK_TIME_UPDATED,y),j.subscribe(j.eventList.ENAME_PLAYBACK_RATE_CHANGED,y),j.subscribe(j.eventList.ENAME_PLAYBACK_SEEKING,y),j.subscribe(j.eventList.ENAME_PLAYBACK_SEEKING,s),j.subscribe(j.eventList.ENAME_PLAYBACK_PAUSED,s),j.subscribe(j.eventList.ENAME_PLAYBACK_STARTED,s),a&&j.subscribe(j.eventList.ENAME_WALLCLOCK_TIME_UPDATED,r),v.subscribe(v.eventList.ENAME_REPRESENTATION_UPDATED,r),w.subscribe(w.eventList.ENAME_INITIALIZATION_LOADED,v),w.subscribe(w.eventList.ENAME_SEGMENTS_LOADED,v),y.initialize(c,f,k,p),s.initialize(c,this),o=this.getFragmentModel(),o.setLoader(x),o.subscribe(o.eventList.ENAME_FRAGMENT_LOADING_STARTED,i),o.subscribe(o.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,i),o.subscribe(o.eventList.ENAME_STREAM_COMPLETED,i),o.subscribe(o.eventList.ENAME_FRAGMENT_LOADING_FAILED,s),x.subscribe(x.eventList.ENAME_LOADING_COMPLETED,o),y.subscribe(y.eventList.ENAME_BUFFER_LEVEL_OUTRUN,o),y.subscribe(y.eventList.ENAME_BUFFER_LEVEL_BALANCED,o),r.initialize(this),r.updateData(l,m,c)
},getData:function(){return this.representationController.getData()},getDataIndex:function(){return this.representationController.getDataIndex()},isUpdating:function(){return this.representationController.isUpdating()},getType:function(){return c},getFragmentModel:function(){return this.scheduleController.getFragmentModel()},updateData:function(a,b){return this.representationController.updateData(a,b,c)},start:function(){this.scheduleController.start()},seek:function(a){this.scheduleController.seek(a)},stop:function(){this.scheduleController.stop()},getCurrentRepresentation:function(){return this.representationController.getCurrentRepresentation()},isBufferingCompleted:function(){return this.bufferController.isBufferingCompleted()},isDynamic:function(){return a},reset:function(a){var c=this,d=c.bufferController,e=c.representationController,f=c.scheduleController,g=c.liveEdgeFinder,h=c.fragmentController,i=c.requestScheduler,j=c.abrController,k=c.playbackController,l=this.indexHandler,m=this.baseURLExt,n=this.getFragmentModel(),o=this.fragmentLoader,p=c.videoModel;j.unsubscribe(j.eventList.ENAME_QUALITY_CHANGED,d),j.unsubscribe(j.eventList.ENAME_QUALITY_CHANGED,e),j.unsubscribe(j.eventList.ENAME_QUALITY_CHANGED,f),i.unsubscribe(i.eventList.ENAME_SCHEDULED_TIME_OCCURED,d),i.unsubscribe(i.eventList.ENAME_SCHEDULED_TIME_OCCURED,f),g.unsubscribe(g.eventList.ENAME_LIVE_EDGE_FOUND,c.timelineConverter),g.unsubscribe(g.eventList.ENAME_LIVE_EDGE_FOUND,f),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_STARTED,f),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_COMPLETED,d),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_COMPLETED,f),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_COMPLETED,j),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_COMPLETED,b),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_COMPLETED,g),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_COMPLETED,k),h.unsubscribe(h.eventList.ENAME_INIT_SEGMENT_LOADED,d),h.unsubscribe(h.eventList.ENAME_MEDIA_SEGMENT_LOADED,d),h.unsubscribe(h.eventList.ENAME_INIT_SEGMENT_LOADING_START,f),h.unsubscribe(h.eventList.ENAME_MEDIA_SEGMENT_LOADING_START,f),h.unsubscribe(h.eventList.ENAME_STREAM_COMPLETED,f),h.unsubscribe(h.eventList.ENAME_STREAM_COMPLETED,d),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,p),d.unsubscribe(d.eventList.ENAME_MIN_BUFFER_TIME_UPDATED,i),d.unsubscribe(d.eventList.ENAME_BUFFER_CLEARED,f),d.unsubscribe(d.eventList.ENAME_BUFFERING_COMPLETED,f),d.unsubscribe(d.eventList.ENAME_BYTES_APPENDED,f),d.unsubscribe(d.eventList.ENAME_BYTES_REJECTED,f),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_OUTRUN,f),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_UPDATED,f),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,f),d.unsubscribe(d.eventList.ENAME_INIT_REQUESTED,f),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_BALANCED,h),d.unsubscribe(d.eventList.ENAME_BUFFERING_COMPLETED,b),d.unsubscribe(d.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,f),k.unsubscribe(k.eventList.ENAME_PLAYBACK_PROGRESS,d),k.unsubscribe(k.eventList.ENAME_PLAYBACK_TIME_UPDATED,d),k.unsubscribe(k.eventList.ENAME_PLAYBACK_RATE_CHANGED,d),k.unsubscribe(k.eventList.ENAME_PLAYBACK_SEEKING,d),k.unsubscribe(k.eventList.ENAME_PLAYBACK_SEEKING,f),k.unsubscribe(k.eventList.ENAME_PLAYBACK_PAUSED,f),k.unsubscribe(k.eventList.ENAME_PLAYBACK_STARTED,f),k.unsubscribe(k.eventList.ENAME_WALLCLOCK_TIME_UPDATED,e),l.unsubscribe(l.eventList.ENAME_REPRESENTATION_UPDATED,e),m.unsubscribe(m.eventList.ENAME_INITIALIZATION_LOADED,l),m.unsubscribe(m.eventList.ENAME_SEGMENTS_LOADED,l),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_OUTRUN,n),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_BALANCED,n),n.unsubscribe(n.eventList.ENAME_FRAGMENT_LOADING_STARTED,h),n.unsubscribe(n.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,h),n.unsubscribe(n.eventList.ENAME_STREAM_COMPLETED,h),n.unsubscribe(n.eventList.ENAME_FRAGMENT_LOADING_FAILED,f),o.unsubscribe(o.eventList.ENAME_LOADING_COMPLETED,n),h.resetModel(n),this.liveEdgeFinder.abortSearch(),this.bufferController.reset(a),this.scheduleController.reset(),this.bufferController=null,this.scheduleController=null,this.representationController=null,this.videoModel=null,this.fragmentController=null,this.requestScheduler=null}}},MediaPlayer.dependencies.StreamProcessor.prototype={constructor:MediaPlayer.dependencies.StreamProcessor},MediaPlayer.models.VideoModel=function(){"use strict";var a,b=[],c=function(){return b.length>0},d=function(c){null!==c&&(a.playbackRate=0,b[c]!==!0&&(b.push(c),b[c]=!0))},e=function(d){if(null!==d){b[d]=!1;var e=b.indexOf(d);-1!==e&&b.splice(e,1),c()===!1&&(a.playbackRate=1)}},f=function(a,b){b?d(a):e(a)},g=function(a,b){var c=a.streamProcessor.getType();f.call(this,c,!b)};return{system:void 0,setup:function(){this.bufferLevelStateChanged=g},play:function(){a.play()},pause:function(){a.pause()},isPaused:function(){return a.paused},getPlaybackRate:function(){return a.playbackRate},setPlaybackRate:function(b){a.playbackRate=b},getCurrentTime:function(){return a.currentTime},setCurrentTime:function(b){a.currentTime!=b&&(a.currentTime=b)},listen:function(b,c){a.addEventListener(b,c,!1)},unlisten:function(b,c){a.removeEventListener(b,c,!1)},getElement:function(){return a},setElement:function(b){a=b},setSource:function(b){a.src=b}}},MediaPlayer.models.VideoModel.prototype={constructor:MediaPlayer.models.VideoModel},MediaPlayer.dependencies.VideoModelExtensions=function(){"use strict";return{getPlaybackQuality:function(a){var b="webkitDroppedFrameCount"in a,c="getVideoPlaybackQuality"in a,d=null;return c?d=a.getVideoPlaybackQuality():b&&(d={droppedVideoFrames:a.webkitDroppedFrameCount,creationTime:new Date}),d}}},MediaPlayer.dependencies.VideoModelExtensions.prototype={constructor:MediaPlayer.dependencies.VideoModelExtensions},MediaPlayer.utils.TTMLParser=function(){"use strict";var a,b=3600,c=60,d=/^(0[0-9]|1[0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])((\.[0-9][0-9][0-9])|(:[0-9][0-9]))$/,e=function(e){var f,g,h,i=d.test(e);if(!i)return 0/0;if(f=e.split(":"),g=parseFloat(f[0])*b+parseFloat(f[1])*c+parseFloat(f[2]),f[3]){if(h=a.tt.frameRate,!h||isNaN(h))return 0/0;g+=parseFloat(f[3])/h}return g},f=function(){var b=!1,c=a.hasOwnProperty("tt"),d=c?a.tt.hasOwnProperty("head"):!1,e=d?a.tt.head.hasOwnProperty("layout"):!1,f=d?a.tt.head.hasOwnProperty("styling"):!1,g=c?a.tt.hasOwnProperty("body"):!1,h=d?a.tt.head.hasOwnProperty("profile"):!1;return c&&d&&e&&f&&g&&(b=!0),b&&(b=h&&"http://www.w3.org/ns/ttml/profile/sdp-us"===a.tt.head.profile.use),b},g=function(a,b){var c=Object.keys(a).filter(function(c){return"xmlns"===c.split(":")[0]&&a[c]===b}).map(function(a){return a.split(":")[1]});return 1!=c.length?null:c[0]},h=function(b){var c,d,h,i,j,k,l,m=[],n=new X2JS([],"",!1);if(a=n.xml_str2json(b),!f())throw c="TTML document has incorrect structure";if(k=g(a.tt,"http://www.w3.org/ns/ttml#parameter"),a.tt.hasOwnProperty(k+":frameRate")&&(a.tt.frameRate=parseInt(a.tt[k+":frameRate"],10)),d=a.tt.body.div_asArray[0].p_asArray,!d||0===d.length)throw c="TTML document does not contain any cues";for(l=0;l<d.length;l+=1){if(h=d[l],i=e(h.begin),j=e(h.end),isNaN(i)||isNaN(j))throw c="TTML document has incorrect timing value";m.push({start:i,end:j,data:h.__text})}return m};return{parse:h}},MediaPlayer.dependencies.TextController=function(){var a,b,c,d=!1,e=function(){d||(b.hasOwnProperty("initialize")&&b.initialize(c,this),d=!0),this.notify(this.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,0)},f=function(a,c,d){var e=this;c===e.streamProcessor.getFragmentModel()&&null!==d&&e.sourceBufferExt.append(b,d,e.videoModel)};return{sourceBufferExt:void 0,debug:void 0,system:void 0,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this.dataUpdateCompleted=e,this.initSegmentLoaded=f;var a=function(){};this.liveEdgeFound=a,this.mediaSegmentLoaded=a,this.streamCompleted=a,this.scheduledTimeOccurred=a,this.qualityChanged=a,this.playbackProgress=a,this.playbackSeeking=a,this.playbackTimeUpdated=a,this.playbackRateChanged=a},initialize:function(a,b,d,e){var f=this;c=a,f.setBuffer(b),f.setMediaSource(d),f.videoModel=e.videoModel,f.representationController=e.representationController,f.streamProcessor=e},getBuffer:function(){return b},setBuffer:function(a){b=a},setMediaSource:function(b){a=b},reset:function(c){c||(this.sourceBufferExt.abort(a,b),this.sourceBufferExt.removeSourceBuffer(a,b))}}},MediaPlayer.dependencies.TextController.prototype={constructor:MediaPlayer.dependencies.TextController},MediaPlayer.dependencies.TextSourceBuffer=function(){var a,b;return{system:void 0,eventBus:void 0,errHandler:void 0,initialize:function(c,d){b=c,this.videoModel=d.videoModel,a=d.streamProcessor.getData()},append:function(b){var c,d,e,f=this,g=String.fromCharCode.apply(null,new Uint16Array(b));try{c=f.getParser().parse(g),d=a.Representation_asArray[0].id,e=a.lang,f.getTextTrackExtensions().addTextTrack(f.videoModel.getElement(),c,d,e,!0),f.eventBus.dispatchEvent({type:"updateend"})}catch(h){f.errHandler.closedCaptionsError(h,"parse",g)}},abort:function(){this.getTextTrackExtensions().deleteCues(this.videoModel.getElement())},getParser:function(){var a;return"text/vtt"===b?a=this.system.getObject("vttParser"):"application/ttml+xml"===b&&(a=this.system.getObject("ttmlParser")),a},getTextTrackExtensions:function(){return this.system.getObject("textTrackExtensions")},addEventListener:function(a,b,c){this.eventBus.addEventListener(a,b,c)},removeEventListener:function(a,b,c){this.eventBus.removeEventListener(a,b,c)}}},MediaPlayer.dependencies.TextSourceBuffer.prototype={constructor:MediaPlayer.dependencies.TextSourceBuffer},MediaPlayer.utils.TextTrackExtensions=function(){"use strict";return{addTextTrack:function(a,b,c,d,e){var f=a.addTextTrack("captions",c,d);f.default=e,f.mode="showing";for(var g in b){var h=b[g];f.addCue(new TextTrackCue(h.start,h.end,h.data))}return f},deleteCues:function(a){for(var b=a.textTracks[0],c=b.cues,d=c.length-1,e=d;e>=0;e-=1)b.removeCue(c[e]);b.mode="disabled"}}},MediaPlayer.utils.VTTParser=function(){"use strict";var a=function(a){var b=a.split(":"),c=b.length-1;return a=60*parseInt(b[c-1],10)+parseFloat(b[c],10),2===c&&(a+=3600*parseInt(b[0],10)),a};return{parse:function(b){var c,d=/(?:\r\n|\r|\n)/gm,e=/-->/,f=/(^[\s]+|[\s]+$)/g,g=[];b=b.split(d),c=b.length;for(var h=0;c>h;h++){var i=b[h];if(i.length>0&&"WEBVTT"!==i&&i.match(e)){var j=i.split(e),k=b[h+1];g.push({start:a(j[0].replace(f,"")),end:a(j[1].replace(f,"")),data:k})}}return g}}},MediaPlayer.rules.BaseRulesCollection=function(){"use strict";var a=[];return{downloadRatioRule:void 0,insufficientBufferRule:void 0,getRules:function(){return a},setup:function(){var a,b=this;a=b.getRules(),a.push(b.downloadRatioRule),a.push(b.insufficientBufferRule)}}},MediaPlayer.rules.BaseRulesCollection.prototype={constructor:MediaPlayer.rules.BaseRulesCollection},MediaPlayer.rules.DownloadRatioRule=function(){"use strict";var a=function(a,b,c){var d,e,f=this;return e=f.manifestExt.getRepresentationFor(a,c),d=f.manifestExt.getBandwidth(e),d/b};return{debug:void 0,manifestExt:void 0,metricsExt:void 0,checkIndex:function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r=this,s=r.metricsExt.getCurrentHttpRequest(c),t=.75;if(!c)return new MediaPlayer.rules.SwitchRequest;if(null===s)return new MediaPlayer.rules.SwitchRequest;if(f=(s.tfinish.getTime()-s.trequest.getTime())/1e3,e=(s.tfinish.getTime()-s.tresponse.getTime())/1e3,0>=f)return new MediaPlayer.rules.SwitchRequest;if(null===s.mediaduration||void 0===s.mediaduration||s.mediaduration<=0||isNaN(s.mediaduration))return new MediaPlayer.rules.SwitchRequest;if(h=s.mediaduration/f,g=s.mediaduration/e*t,isNaN(g)||isNaN(h))return r.debug.log("The ratios are NaN, bailing."),new MediaPlayer.rules.SwitchRequest;if(isNaN(g))q=new MediaPlayer.rules.SwitchRequest;else if(4>g)b>0?(r.debug.log("We are not at the lowest bitrate, so switch down."),m=r.manifestExt.getRepresentationFor(b-1,d),j=r.manifestExt.getBandwidth(m),n=r.manifestExt.getRepresentationFor(b,d),l=r.manifestExt.getBandwidth(n),i=j/l,i>g?(r.debug.log("Things must be going pretty bad, switch all the way down."),q=new MediaPlayer.rules.SwitchRequest(0)):(r.debug.log("Things could be better, so just switch down one index."),q=new MediaPlayer.rules.SwitchRequest(b-1))):q=new MediaPlayer.rules.SwitchRequest(b);else if(p=r.manifestExt.getRepresentationCount(d)-1,p>b)if(m=r.manifestExt.getRepresentationFor(b+1,d),k=r.manifestExt.getBandwidth(m),n=r.manifestExt.getRepresentationFor(b,d),l=r.manifestExt.getBandwidth(n),i=k/l,g>=i)if(g>100)r.debug.log("Tons of bandwidth available, go all the way up."),q=new MediaPlayer.rules.SwitchRequest(p-1);else if(g>10)r.debug.log("Just enough bandwidth available, switch up one."),q=new MediaPlayer.rules.SwitchRequest(b+1);else{for(o=-1;(o+=1)<p&&!(g<a.call(r,o,l,d)););r.debug.log("Calculated ideal new quality index is: "+o),q=new MediaPlayer.rules.SwitchRequest(o)}else q=new MediaPlayer.rules.SwitchRequest;else q=new MediaPlayer.rules.SwitchRequest(p);return q}}},MediaPlayer.rules.DownloadRatioRule.prototype={constructor:MediaPlayer.rules.DownloadRatioRule},MediaPlayer.rules.InsufficientBufferRule=function(){"use strict";var a=0,b=3;return{debug:void 0,checkIndex:function(c,d){var e,f,g=this,h=!1,i=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT;return null===d.PlayList||void 0===d.PlayList||0===d.PlayList.length?new MediaPlayer.rules.SwitchRequest:(e=d.PlayList[d.PlayList.length-1],null===e||void 0===e||0===e.trace.length?new MediaPlayer.rules.SwitchRequest:(f=e.trace[e.trace.length-2],null===f||void 0===f||null===f.stopreason||void 0===f.stopreason?new MediaPlayer.rules.SwitchRequest:(f.stopreason===MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON&&(h=!0,a+=1,g.debug.log("Number of times the buffer has run dry: "+a)),a>b&&(i=MediaPlayer.rules.SwitchRequest.prototype.STRONG,g.debug.log("Apply STRONG to buffer rule.")),h?(g.debug.log("The buffer ran dry recently, switch down."),new MediaPlayer.rules.SwitchRequest(c-1,i)):a>b?(g.debug.log("Too many dry buffer hits, quit switching bitrates."),new MediaPlayer.rules.SwitchRequest(c,i)):new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,i))))}}},MediaPlayer.rules.InsufficientBufferRule.prototype={constructor:MediaPlayer.rules.InsufficientBufferRule},MediaPlayer.rules.LimitSwitchesRule=function(){"use strict";var a=10,b=2e4,c=5,d=0;return{debug:void 0,checkIndex:function(e,f){if(d>0)return d-=1,new MediaPlayer.rules.SwitchRequest(e,MediaPlayer.rules.SwitchRequest.prototype.STRONG);var g,h,i,j=this,k=!1,l=(new Date).getTime(),m=f.RepSwitchList.length;for(i=m-1;i>=0;i-=1){if(g=f.RepSwitchList[i],h=l-g.t.getTime(),h>=b){j.debug.log("Reached time limit, bailing.");break}if(i>=a){j.debug.log("Found too many switches within validation time, force the stream to not change."),k=!0;break}}return k?(j.debug.log("Wait some time before allowing another switch."),d=c,new MediaPlayer.rules.SwitchRequest(e,MediaPlayer.rules.SwitchRequest.prototype.STRONG)):new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,MediaPlayer.rules.SwitchRequest.prototype.STRONG)}}},MediaPlayer.rules.LimitSwitchesRule.prototype={constructor:MediaPlayer.rules.LimitSwitchesRule},MediaPlayer.rules.SwitchRequest=function(a,b){"use strict";this.quality=a,this.priority=b,void 0===this.quality&&(this.quality=999),void 0===this.priority&&(this.priority=.5)},MediaPlayer.rules.SwitchRequest.prototype={constructor:MediaPlayer.rules.SwitchRequest,NO_CHANGE:999,DEFAULT:.5,STRONG:1,WEAK:0},MediaPlayer.models.MetricsList=function(){"use strict";return{TcpList:[],HttpList:[],RepSwitchList:[],BufferLevel:[],PlayList:[],DroppedFrames:[]}},MediaPlayer.models.MetricsList.prototype={constructor:MediaPlayer.models.MetricsList},MediaPlayer.vo.SegmentRequest=function(){"use strict";this.action="download",this.startTime=0/0,this.streamType=null,this.type=null,this.duration=0/0,this.timescale=0/0,this.range=null,this.url=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=0/0,this.index=0/0,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null},MediaPlayer.vo.SegmentRequest.prototype={constructor:MediaPlayer.vo.SegmentRequest,ACTION_DOWNLOAD:"download",ACTION_COMPLETE:"complete"},MediaPlayer.vo.metrics.BufferLevel=function(){"use strict";this.t=null,this.level=null},MediaPlayer.vo.metrics.BufferLevel.prototype={constructor:MediaPlayer.vo.metrics.BufferLevel},MediaPlayer.vo.metrics.DroppedFrames=function(){"use strict";this.time=null,this.droppedFrames=null},MediaPlayer.vo.metrics.DroppedFrames.prototype={constructor:MediaPlayer.vo.metrics.DroppedFrames},MediaPlayer.vo.metrics.HTTPRequest=function(){"use strict";this.stream=null,this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.tfinish=null,this.responsecode=null,this.interval=null,this.mediaduration=null,this.trace=[]},MediaPlayer.vo.metrics.HTTPRequest.prototype={constructor:MediaPlayer.vo.metrics.HTTPRequest},MediaPlayer.vo.metrics.HTTPRequest.Trace=function(){"use strict";this.s=null,this.d=null,this.b=[]},MediaPlayer.vo.metrics.HTTPRequest.Trace.prototype={constructor:MediaPlayer.vo.metrics.HTTPRequest.Trace},MediaPlayer.vo.metrics.PlayList=function(){"use strict";this.stream=null,this.start=null,this.mstart=null,this.starttype=null,this.trace=[]},MediaPlayer.vo.metrics.PlayList.Trace=function(){"use strict";this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null},MediaPlayer.vo.metrics.PlayList.prototype={constructor:MediaPlayer.vo.metrics.PlayList},MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON="initial_start",MediaPlayer.vo.metrics.PlayList.SEEK_START_REASON="seek",MediaPlayer.vo.metrics.PlayList.Trace.prototype={constructor:MediaPlayer.vo.metrics.PlayList.Trace()},MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON="user_request",MediaPlayer.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",MediaPlayer.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON="end_of_content",MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON="rebuffering",MediaPlayer.vo.metrics.RepresentationSwitch=function(){"use strict";this.t=null,this.mt=null,this.to=null,this.lto=null},MediaPlayer.vo.metrics.RepresentationSwitch.prototype={constructor:MediaPlayer.vo.metrics.RepresentationSwitch},MediaPlayer.vo.metrics.TCPConnection=function(){"use strict";this.tcpid=null,this.dest=null,this.topen=null,this.tclose=null,this.tconnect=null},MediaPlayer.vo.metrics.TCPConnection.prototype={constructor:MediaPlayer.vo.metrics.TCPConnection};